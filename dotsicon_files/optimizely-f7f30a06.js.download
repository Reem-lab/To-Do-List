(function(Xe){"use strict";var Fr=Object.defineProperty,kr=(e,t)=>Fr(e,"name",{value:t,configurable:!0});function Rt(){return typeof Blob=="function"&&typeof PerformanceObserver=="function"&&typeof Intl!="undefined"&&typeof MutationObserver!="undefined"&&typeof URLSearchParams!="undefined"&&typeof WebSocket!="undefined"&&typeof IntersectionObserver!="undefined"&&typeof AbortController!="undefined"&&typeof queueMicrotask!="undefined"&&typeof TextEncoder!="undefined"&&typeof TextDecoder!="undefined"&&typeof customElements!="undefined"&&typeof HTMLDetailsElement!="undefined"&&"fromEntries"in Object&&"entries"in FormData.prototype&&"toggleAttribute"in Element.prototype&&"flatMap"in Array.prototype&&"replaceChildren"in Element.prototype}kr(Rt,"capableBrowser");var wr=Object.defineProperty,Br=(e,t)=>wr(e,"name",{value:t,configurable:!0});function Tt(e){var t,r;const i=(r=(t=e.head)==null?void 0:t.querySelector('meta[name="expected-hostname"]'))==null?void 0:r.content;if(!i)return!1;const n=i.replace(/\.$/,"").split(".").slice(-2).join("."),a=e.location.hostname.replace(/\.$/,"").split(".").slice(-2).join(".");return n!==a}Br(Tt,"detectProxySite");let $e;function Ot(){return`${Math.round(Math.random()*(Math.pow(2,31)-1))}.${Math.round(Date.now()/1e3)}`}function Gr(e){const t=`GH1.1.${e}`,r=Date.now(),i=new Date(r+1*365*86400*1e3).toUTCString();let{domain:n}=document;n.endsWith(".github.com")&&(n="github.com"),document.cookie=`_octo=${t}; expires=${i}; path=/; domain=${n}; secure; samesite=lax`}function Kr(){let e;const r=document.cookie.match(/_octo=([^;]+)/g);if(!r)return;let i=[0,0];for(const n of r){const[,a]=n.split("="),[,o,...s]=a.split("."),u=o.split("-").map(Number);u>i&&(i=u,e=s.join("."))}return e}function Z(){try{const e=Kr();if(e)return e;const t=Ot();return Gr(t),t}catch(e){return $e||($e=Ot()),$e}}var fe="<unknown>";function jr(e){var t=e.split(`
`);return t.reduce(function(r,i){var n=Yr(i)||zr(i)||Jr(i)||tn(i)||Qr(i);return n&&r.push(n),r},[])}var Hr=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,qr=/\((\S*)(?::(\d+))(?::(\d+))\)/;function Yr(e){var t=Hr.exec(e);if(!t)return null;var r=t[2]&&t[2].indexOf("native")===0,i=t[2]&&t[2].indexOf("eval")===0,n=qr.exec(t[2]);return i&&n!=null&&(t[2]=n[1],t[3]=n[2],t[4]=n[3]),{file:r?null:t[2],methodName:t[1]||fe,arguments:r?[t[2]]:[],lineNumber:t[3]?+t[3]:null,column:t[4]?+t[4]:null}}var Wr=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i;function zr(e){var t=Wr.exec(e);return t?{file:t[2],methodName:t[1]||fe,arguments:[],lineNumber:+t[3],column:t[4]?+t[4]:null}:null}var Xr=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,$r=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;function Jr(e){var t=Xr.exec(e);if(!t)return null;var r=t[3]&&t[3].indexOf(" > eval")>-1,i=$r.exec(t[3]);return r&&i!=null&&(t[3]=i[1],t[4]=i[2],t[5]=null),{file:t[3],methodName:t[1]||fe,arguments:t[2]?t[2].split(","):[],lineNumber:t[4]?+t[4]:null,column:t[5]?+t[5]:null}}var Zr=/^\s*(?:([^@]*)(?:\((.*?)\))?@)?(\S.*?):(\d+)(?::(\d+))?\s*$/i;function Qr(e){var t=Zr.exec(e);return t?{file:t[3],methodName:t[1]||fe,arguments:[],lineNumber:+t[4],column:t[5]?+t[5]:null}:null}var en=/^\s*at (?:((?:\[object object\])?[^\\/]+(?: \[as \S+\])?) )?\(?(.*?):(\d+)(?::(\d+))?\)?\s*$/i;function tn(e){var t=en.exec(e);return t?{file:t[2],methodName:t[1]||fe,arguments:[],lineNumber:+t[3],column:t[4]?+t[4]:null}:null}var rn=Object.defineProperty,me=(e,t)=>rn(e,"name",{value:t,configurable:!0});function ye(e){const t=document.querySelectorAll(e);if(t.length>0)return t[t.length-1]}me(ye,"queryLast");function Nt(){const e=ye("meta[name=analytics-location]");return e?e.content:window.location.pathname}me(Nt,"pagePathname");function At(){const e=ye("meta[name=analytics-location-query-strip]");let t="";e||(t=window.location.search);const r=ye("meta[name=analytics-location-params]");r&&(t+=(t?"&":"?")+r.content);for(const i of document.querySelectorAll("meta[name=analytics-param-rename]")){const n=i.content.split(":",2);t=t.replace(new RegExp(`(^|[?&])${n[0]}($|=)`,"g"),`$1${n[1]}$2`)}return t}me(At,"pageQuery");function Je(){return`${window.location.protocol}//${window.location.host}${Nt()+At()}`}me(Je,"requestUri");var nn=Object.defineProperty,Y=(e,t)=>nn(e,"name",{value:t,configurable:!0});let St=!1,Lt=0;const on=Date.now();function an(e){e.error&&Re(Oe(Te(e.error)))}Y(an,"reportEvent");async function sn(e){if(!!e.promise)try{await e.promise}catch(t){t&&t.name!=="AbortError"&&!(t.response instanceof Response)&&Re(Oe(Te(t)))}}Y(sn,"reportPromiseRejectionEvent");function Ut(e,t={}){Re(Oe(Te(e),t))}Y(Ut,"reportError");async function Re(e){var t,r;if(!Pt())return;const i=(r=(t=document.head)==null?void 0:t.querySelector('meta[name="browser-errors-url"]'))==null?void 0:r.content;if(!!i){if(Ct(e.error.stacktrace)){St=!0;return}Lt++;try{await fetch(i,{method:"post",body:JSON.stringify(e)})}catch(n){}}}Y(Re,"report");function Te(e){return{type:e.name,value:e.message,stacktrace:Ze(e)}}Y(Te,"formatError");function Oe(e,t={}){return Object.assign({error:e,sanitizedUrl:Je()||window.location.href,readyState:document.readyState,referrer:document.referrer,timeSinceLoad:Math.round(Date.now()-on),user:Qe()||void 0},t)}Y(Oe,"errorContext");function Ze(e){var t;const r=Dt(e),i=(t=e.framesToPop)!=null?t:0;return i===0?r:r.slice(i)}Y(Ze,"stacktrace");function Dt(e){return jr(e.stack||"").map(t=>({filename:t.file||"",function:String(t.methodName),lineno:(t.lineNumber||0).toString(),colno:(t.column||0).toString()}))}Y(Dt,"parseStackTrace");const bt=/(chrome|moz|safari)-extension:\/\//;function Ct(e){return e.some(t=>bt.test(t.filename)||bt.test(t.function))}Y(Ct,"isExtensionError");function Qe(){var e,t;const r=(t=(e=document.head)==null?void 0:e.querySelector('meta[name="user-login"]'))==null?void 0:t.content;return r||`anonymous-${Z()}`}Y(Qe,"pageUser");let et=!1;window.addEventListener("pageshow",()=>et=!1),window.addEventListener("pagehide",()=>et=!0);function Pt(){return!et&&!St&&Lt<10&&Rt()&&!Tt(document)}Y(Pt,"reportable"),typeof BroadcastChannel=="function"&&new BroadcastChannel("shared-worker-error").addEventListener("message",t=>{Ut(t.data.error)});var w=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function C(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function b(e,t){return t={exports:{}},e(t,t.exports),t.exports}function un(e){return e&&e.default||e}var Q=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function s(){}return s.prototype.handleError=function(u){},s}();t.NoopErrorHandler=r;var i=new r;function n(s){i=s}t.setErrorHandler=n;function a(){return i}t.getErrorHandler=a;function o(){i=new r}t.resetErrorHandler=o});C(Q),Q.NoopErrorHandler,Q.setErrorHandler,Q.getErrorHandler,Q.resetErrorHandler;var D=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(r){r[r.NOTSET=0]="NOTSET",r[r.DEBUG=1]="DEBUG",r[r.INFO=2]="INFO",r[r.WARNING=3]="WARNING",r[r.ERROR=4]="ERROR"}(t.LogLevel||(t.LogLevel={}))});C(D),D.LogLevel;var Vt={v4(){return crypto.randomUUID()}},ln=Object.freeze({__proto__:null,default:Vt}),cn=un(ln),V=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function r(){return new Date().getTime()}t.getTimestamp=r;function i(){return cn.v4()}t.generateUUID=i;function n(p,c){for(var d=!1,_=Object.keys(p),g=0;g<_.length;g++)if(c===p[_[g]]){d=!0;break}return d}t.isValidEnum=n;function a(p,c){var d={};return p.forEach(function(_){var g=c(_);d[g]=d[g]||[],d[g].push(_)}),o(d)}t.groupBy=a;function o(p){return Object.keys(p).map(function(c){return p[c]})}t.objectValues=o;function s(p){return Object.keys(p).map(function(c){return[c,p[c]]})}t.objectEntries=s;function u(p,c){for(var d,_=0,g=p;_<g.length;_++){var h=g[_];if(c(h)){d=h;break}}return d}t.find=u;function l(p,c){var d={};return p.forEach(function(_){var g=c(_);d[g]=_}),d}t.keyBy=l;function E(p){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var _=0;return p.replace(/%s/g,function(){var g=c[_++],h=typeof g;return h==="function"?g():h==="string"?g:String(g)})}t.sprintf=E,function(p){p.ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",p.DECISION="DECISION:type, userId, attributes, decisionInfo",p.LOG_EVENT="LOG_EVENT:logEvent",p.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",p.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"}(t.NOTIFICATION_TYPES||(t.NOTIFICATION_TYPES={}))});C(V),V.getTimestamp,V.generateUUID,V.isValidEnum,V.groupBy;var ee=V.objectValues;V.objectEntries,V.find;var fn=V.keyBy,f=V.sprintf,dn=V.NOTIFICATION_TYPES,$=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function i(g){return typeof g!="string"||(g=g.toUpperCase(),g==="WARN"&&(g="WARNING"),!r[g])?g:r[g]}var n=function(){function g(){this.defaultLoggerFacade=new u,this.loggers={}}return g.prototype.getLogger=function(h){return h?(this.loggers[h]||(this.loggers[h]=new u({messagePrefix:h})),this.loggers[h]):this.defaultLoggerFacade},g}(),a=function(){function g(h){h===void 0&&(h={}),this.logLevel=D.LogLevel.NOTSET,h.logLevel!==void 0&&V.isValidEnum(D.LogLevel,h.logLevel)&&this.setLogLevel(h.logLevel),this.logToConsole=h.logToConsole!==void 0?!!h.logToConsole:!0,this.prefix=h.prefix!==void 0?h.prefix:"[OPTIMIZELY]"}return g.prototype.log=function(h,I){if(!(!this.shouldLog(h)||!this.logToConsole)){var T=this.prefix+" - "+this.getLogLevelName(h)+" "+this.getTime()+" "+I;this.consoleLog(h,[T])}},g.prototype.setLogLevel=function(h){h=i(h),!V.isValidEnum(D.LogLevel,h)||h===void 0?this.logLevel=D.LogLevel.ERROR:this.logLevel=h},g.prototype.getTime=function(){return new Date().toISOString()},g.prototype.shouldLog=function(h){return h>=this.logLevel},g.prototype.getLogLevelName=function(h){switch(h){case D.LogLevel.DEBUG:return"DEBUG";case D.LogLevel.INFO:return"INFO ";case D.LogLevel.WARNING:return"WARN ";case D.LogLevel.ERROR:return"ERROR";default:return"NOTSET"}},g.prototype.consoleLog=function(h,I){switch(h){case D.LogLevel.DEBUG:console.log.apply(console,I);break;case D.LogLevel.INFO:console.info.apply(console,I);break;case D.LogLevel.WARNING:console.warn.apply(console,I);break;case D.LogLevel.ERROR:console.error.apply(console,I);break;default:console.log.apply(console,I)}},g}();t.ConsoleLogHandler=a;var o=D.LogLevel.NOTSET,s=null,u=function(){function g(h){h===void 0&&(h={}),this.messagePrefix="",h.messagePrefix&&(this.messagePrefix=h.messagePrefix)}return g.prototype.log=function(h,I){this.internalLog(i(h),{message:I,splat:[]})},g.prototype.info=function(h){for(var I=[],T=1;T<arguments.length;T++)I[T-1]=arguments[T];this.namedLog(D.LogLevel.INFO,h,I)},g.prototype.debug=function(h){for(var I=[],T=1;T<arguments.length;T++)I[T-1]=arguments[T];this.namedLog(D.LogLevel.DEBUG,h,I)},g.prototype.warn=function(h){for(var I=[],T=1;T<arguments.length;T++)I[T-1]=arguments[T];this.namedLog(D.LogLevel.WARNING,h,I)},g.prototype.error=function(h){for(var I=[],T=1;T<arguments.length;T++)I[T-1]=arguments[T];this.namedLog(D.LogLevel.ERROR,h,I)},g.prototype.format=function(h){return""+(this.messagePrefix?this.messagePrefix+": ":"")+V.sprintf.apply(void 0,[h.message].concat(h.splat))},g.prototype.internalLog=function(h,I){!s||h<o||(s.log(h,this.format(I)),I.error&&I.error instanceof Error&&Q.getErrorHandler().handleError(I.error))},g.prototype.namedLog=function(h,I,T){var X;if(I instanceof Error){X=I,I=X.message,this.internalLog(h,{error:X,message:I,splat:T});return}if(T.length===0){this.internalLog(h,{message:I,splat:T});return}var Ie=T[T.length-1];Ie instanceof Error&&(X=Ie,T.splice(-1)),this.internalLog(h,{message:I,error:X,splat:T})},g}(),l=new n;function E(g){return l.getLogger(g)}t.getLogger=E;function p(g){s=g}t.setLogHandler=p;function c(g){g=i(g),!V.isValidEnum(D.LogLevel,g)||g===void 0?o=D.LogLevel.ERROR:o=g}t.setLogLevel=c;function d(){return o}t.getLogLevel=d;function _(){l=new n,o=D.LogLevel.NOTSET}t.resetLogger=_});C($),$.ConsoleLogHandler,$.getLogger,$.setLogHandler,$.setLogLevel,$.getLogLevel,$.resetLogger;var j=b(function(e,t){function r(i){for(var n in i)t.hasOwnProperty(n)||(t[n]=i[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(Q),r(D),r($)});C(j);var En=j.ConsoleLogHandler,Ne=j.getLogger,Ae=j.setLogLevel,Mt=j.LogLevel,tt=j.setLogHandler,gn=j.setErrorHandler,pn=j.getErrorHandler,Se=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function r(i,n){var a=i.context,o=n.context;return a.accountId===o.accountId&&a.projectId===o.projectId&&a.clientName===o.clientName&&a.clientVersion===o.clientVersion&&a.revision===o.revision&&a.anonymizeIP===o.anonymizeIP&&a.botFiltering===o.botFiltering}t.areEventContextsEqual=r});C(Se),Se.areEventContextsEqual;var de=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=j.getLogger("EventProcessor"),i=function(){function o(s){var u=s.timeout,l=s.callback;this.timeout=Math.max(u,0),this.callback=l}return o.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},o.prototype.refresh=function(){this.stop(),this.start()},o.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},o}(),n=function(){function o(s){var u=s.sink;this.sink=u}return o.prototype.start=function(){},o.prototype.stop=function(){return Promise.resolve()},o.prototype.enqueue=function(s){this.sink([s])},o}();t.SingleEventQueue=n;var a=function(){function o(s){var u=s.flushInterval,l=s.maxQueueSize,E=s.sink,p=s.batchComparator;this.buffer=[],this.maxQueueSize=Math.max(l,1),this.sink=E,this.batchComparator=p,this.timer=new i({callback:this.flush.bind(this),timeout:u}),this.started=!1}return o.prototype.start=function(){this.started=!0},o.prototype.stop=function(){this.started=!1;var s=this.sink(this.buffer);return this.buffer=[],this.timer.stop(),s},o.prototype.enqueue=function(s){if(!this.started){r.warn("Queue is stopped, not accepting event");return}var u=this.buffer[0];u&&!this.batchComparator(u,s)&&this.flush(),this.buffer.length===0&&this.timer.refresh(),this.buffer.push(s),this.buffer.length>=this.maxQueueSize&&this.flush()},o.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},o}();t.DefaultEventQueue=a});C(de),de.SingleEventQueue,de.DefaultEventQueue;var xt=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.reqsInFlightCount=0,this.reqsCompleteResolvers=[]}return i.prototype.trackRequest=function(n){var a=this;this.reqsInFlightCount++;var o=function(){a.reqsInFlightCount--,a.reqsInFlightCount===0&&(a.reqsCompleteResolvers.forEach(function(s){return s()}),a.reqsCompleteResolvers=[])};n.then(o,o)},i.prototype.onRequestsComplete=function(){var n=this;return new Promise(function(a){n.reqsInFlightCount===0?a():n.reqsCompleteResolvers.push(a)})},i}();t.default=r});C(xt);var Le=b(function(e,t){var r=w&&w.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(xt),n=j.getLogger("EventProcessor"),a=3e4,o=10,s=function(){function u(l){var E=l.dispatcher,p=l.flushInterval,c=p===void 0?3e4:p,d=l.maxQueueSize,_=d===void 0?3e3:d,g=l.notificationCenter,h=this;this.dispatcher=E,c<=0&&(n.warn("Invalid flushInterval "+c+", defaulting to "+a),c=a),_=Math.floor(_),_<1&&(n.warn("Invalid maxQueueSize "+_+", defaulting to "+o),_=o),_=Math.max(1,_),_>1?this.queue=new de.DefaultEventQueue({flushInterval:c,maxQueueSize:_,sink:function(I){return h.drainQueue(I)},batchComparator:Se.areEventContextsEqual}):this.queue=new de.SingleEventQueue({sink:function(I){return h.drainQueue(I)}}),this.notificationCenter=g,this.requestTracker=new i.default}return u.prototype.drainQueue=function(l){var E=this,p=new Promise(function(c){if(n.debug("draining queue with %s events",l.length),l.length===0){c();return}var d=E.formatEvents(l);E.dispatcher.dispatchEvent(d,function(){c()}),E.notificationCenter&&E.notificationCenter.sendNotifications(V.NOTIFICATION_TYPES.LOG_EVENT,d)});return this.requestTracker.trackRequest(p),p},u.prototype.process=function(l){this.queue.enqueue(l)},u.prototype.stop=function(){try{return this.queue.stop(),this.requestTracker.onRequestsComplete()}catch(l){n.error('Error stopping EventProcessor: "%s"',l.message,l)}return Promise.resolve()},u.prototype.start=function(){this.queue.start()},u}();t.AbstractEventProcessor=s});C(Le),Le.AbstractEventProcessor;var rt=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=j.getLogger("EventProcessor"),i=function(){function n(a){var o=a.key,s=a.maxValues,u=s===void 0?1e3:s;this.LS_KEY=o,this.maxValues=u}return n.prototype.get=function(a){return this.getMap()[a]||null},n.prototype.set=function(a,o){var s=this.getMap();s[a]=o,this.replace(s)},n.prototype.remove=function(a){var o=this.getMap();delete o[a],this.replace(o)},n.prototype.values=function(){return V.objectValues(this.getMap())},n.prototype.clear=function(){this.replace({})},n.prototype.replace=function(a){try{window.localStorage&&localStorage.setItem(this.LS_KEY,JSON.stringify(a)),this.clean()}catch(o){r.error(o)}},n.prototype.clean=function(){var a=this.getMap(),o=Object.keys(a),s=o.length-this.maxValues;if(!(s<1)){var u=o.map(function(E){return{key:E,value:a[E]}});u.sort(function(E,p){return E.value.timestamp-p.value.timestamp});for(var l=0;l<s;l++)delete a[u[l].key];this.replace(a)}},n.prototype.getMap=function(){try{var a=window.localStorage&&localStorage.getItem(this.LS_KEY);if(a)return JSON.parse(a)||{}}catch(o){r.error(o)}return{}},n}();t.LocalStorageStore=i});C(rt),rt.LocalStorageStore;var Ue=b(function(e,t){var r=w&&w.__extends||function(){var o=function(s,u){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,E){l.__proto__=E}||function(l,E){for(var p in E)E.hasOwnProperty(p)&&(l[p]=E[p])},o(s,u)};return function(s,u){o(s,u);function l(){this.constructor=s}s.prototype=u===null?Object.create(u):(l.prototype=u.prototype,new l)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=j.getLogger("EventProcessor"),n=function(){function o(s){var u=s.eventDispatcher,l=s.store;this.dispatcher=u,this.store=l}return o.prototype.dispatchEvent=function(s,u){this.send({uuid:V.generateUUID(),timestamp:V.getTimestamp(),request:s},u)},o.prototype.sendPendingEvents=function(){var s=this,u=this.store.values();i.debug("Sending %s pending events from previous page",u.length),u.forEach(function(l){try{s.send(l,function(){})}catch(E){}})},o.prototype.send=function(s,u){var l=this;this.store.set(s.uuid,s),this.dispatcher.dispatchEvent(s.request,function(E){l.store.remove(s.uuid),u(E)})},o}();t.PendingEventsDispatcher=n;var a=function(o){r(s,o);function s(u){var l=u.eventDispatcher;return o.call(this,{eventDispatcher:l,store:new rt.LocalStorageStore({maxValues:100,key:"fs_optly_pending_events"})})||this}return s}(n);t.LocalStoragePendingEventsDispatcher=a});C(Ue),Ue.PendingEventsDispatcher,Ue.LocalStoragePendingEventsDispatcher;var ne=b(function(e,t){var r=w&&w.__assign||function(){return r=Object.assign||function(c){for(var d,_=1,g=arguments.length;_<g;_++){d=arguments[_];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(c[h]=d[h])}return c},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i="campaign_activated",n="custom",a="$opt_bot_filtering";function o(c){var d=[],_=c[0];return c.forEach(function(g){if(g.type==="conversion"||g.type==="impression"){var h=l(g);g.type==="impression"?h.snapshots.push(u(g)):g.type==="conversion"&&h.snapshots.push(s(g)),d.push(h)}}),{client_name:_.context.clientName,client_version:_.context.clientVersion,account_id:_.context.accountId,project_id:_.context.projectId,revision:_.context.revision,anonymize_ip:_.context.anonymizeIP,enrich_decisions:!0,visitors:d}}t.makeBatchedEventV1=o;function s(c){var d=r({},c.tags);delete d.revenue,delete d.value;var _={entity_id:c.event.id,key:c.event.key,timestamp:c.timestamp,uuid:c.uuid};return c.tags&&(_.tags=c.tags),c.value!=null&&(_.value=c.value),c.revenue!=null&&(_.revenue=c.revenue),{events:[_]}}function u(c){var d=c.layer,_=c.experiment,g=c.variation,h=d?d.id:null,I=_?_.id:null,T=g?g.id:null;return{decisions:[{campaign_id:h,experiment_id:I,variation_id:T}],events:[{entity_id:h,timestamp:c.timestamp,key:i,uuid:c.uuid}]}}function l(c){var d={snapshots:[],visitor_id:c.user.id,attributes:[]};return c.user.attributes.forEach(function(_){d.attributes.push({entity_id:_.entityId,key:_.key,type:"custom",value:_.value})}),typeof c.context.botFiltering=="boolean"&&d.attributes.push({entity_id:a,key:a,type:n,value:c.context.botFiltering}),d}function E(c){var d=l(c);return d.snapshots.push(u(c)),{client_name:c.context.clientName,client_version:c.context.clientVersion,account_id:c.context.accountId,project_id:c.context.projectId,revision:c.context.revision,anonymize_ip:c.context.anonymizeIP,enrich_decisions:!0,visitors:[d]}}t.buildImpressionEventV1=E;function p(c){var d=l(c);return d.snapshots.push(s(c)),{client_name:c.context.clientName,client_version:c.context.clientVersion,account_id:c.context.accountId,project_id:c.context.projectId,revision:c.context.revision,anonymize_ip:c.context.anonymizeIP,enrich_decisions:!0,visitors:[d]}}t.buildConversionEventV1=p});C(ne),ne.makeBatchedEventV1,ne.buildImpressionEventV1,ne.buildConversionEventV1;var nt=b(function(e,t){var r=w&&w.__extends||function(){var n=function(a,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,u){s.__proto__=u}||function(s,u){for(var l in u)u.hasOwnProperty(l)&&(s[l]=u[l])},n(a,o)};return function(a,o){n(a,o);function s(){this.constructor=a}a.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){r(a,n);function a(){return n!==null&&n.apply(this,arguments)||this}return a.prototype.formatEvents=function(o){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:ne.makeBatchedEventV1(o)}},a}(Le.AbstractEventProcessor);t.LogTierV1EventProcessor=i});C(nt),nt.LogTierV1EventProcessor;var it=b(function(e,t){function r(i){for(var n in i)t.hasOwnProperty(n)||(t[n]=i[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(Se),r(Le),r(Ue),r(ne),r(nt)});C(it);var _n=it.LogTierV1EventProcessor,hn=it.LocalStoragePendingEventsDispatcher,vn=b(function(e){(function(){function t(n,a){for(var o=n.length,s=a^o,u=0,l;o>=4;)l=n.charCodeAt(u)&255|(n.charCodeAt(++u)&255)<<8|(n.charCodeAt(++u)&255)<<16|(n.charCodeAt(++u)&255)<<24,l=(l&65535)*1540483477+(((l>>>16)*1540483477&65535)<<16),l^=l>>>24,l=(l&65535)*1540483477+(((l>>>16)*1540483477&65535)<<16),s=(s&65535)*1540483477+(((s>>>16)*1540483477&65535)<<16)^l,o-=4,++u;switch(o){case 3:s^=(n.charCodeAt(u+2)&255)<<16;case 2:s^=(n.charCodeAt(u+1)&255)<<8;case 1:s^=n.charCodeAt(u)&255,s=(s&65535)*1540483477+(((s>>>16)*1540483477&65535)<<16)}return s^=s>>>13,s=(s&65535)*1540483477+(((s>>>16)*1540483477&65535)<<16),s^=s>>>15,s>>>0}function r(n,a){var o,s,u,l,E,p,c,d;for(o=n.length&3,s=n.length-o,u=a,E=3432918353,p=461845907,d=0;d<s;)c=n.charCodeAt(d)&255|(n.charCodeAt(++d)&255)<<8|(n.charCodeAt(++d)&255)<<16|(n.charCodeAt(++d)&255)<<24,++d,c=(c&65535)*E+(((c>>>16)*E&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(c&65535)*p+(((c>>>16)*p&65535)<<16)&4294967295,u^=c,u=u<<13|u>>>19,l=(u&65535)*5+(((u>>>16)*5&65535)<<16)&4294967295,u=(l&65535)+27492+(((l>>>16)+58964&65535)<<16);switch(c=0,o){case 3:c^=(n.charCodeAt(d+2)&255)<<16;case 2:c^=(n.charCodeAt(d+1)&255)<<8;case 1:c^=n.charCodeAt(d)&255,c=(c&65535)*E+(((c>>>16)*E&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(c&65535)*p+(((c>>>16)*p&65535)<<16)&4294967295,u^=c}return u^=n.length,u^=u>>>16,u=(u&65535)*2246822507+(((u>>>16)*2246822507&65535)<<16)&4294967295,u^=u>>>13,u=(u&65535)*3266489909+(((u>>>16)*3266489909&65535)<<16)&4294967295,u^=u>>>16,u>>>0}var i=r;i.v2=t,i.v3=r,e.exports=i})()}),G=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_UPDATE_INTERVAL=5*60*1e3,t.MIN_UPDATE_INTERVAL=1e3,t.DEFAULT_URL_TEMPLATE="https://cdn.optimizely.com/datafiles/%s.json",t.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT=[0,8,16,32,64,128,256,512],t.REQUEST_TIMEOUT_MS=60*1e3});C(G),G.DEFAULT_UPDATE_INTERVAL,G.MIN_UPDATE_INTERVAL,G.DEFAULT_URL_TEMPLATE,G.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT,G.REQUEST_TIMEOUT_MS;var ot=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=j.getLogger("DatafileManager"),i="GET",n=4;function a(u){var l=u.getAllResponseHeaders();if(l===null)return{};var E=l.split(`\r
`),p={};return E.forEach(function(c){var d=c.indexOf(": ");if(d>-1){var _=c.slice(0,d),g=c.slice(d+2);g.length>0&&(p[_]=g)}}),p}function o(u,l){Object.keys(u).forEach(function(E){var p=u[E];l.setRequestHeader(E,p)})}function s(u,l){var E=new XMLHttpRequest,p=new Promise(function(c,d){E.open(i,u,!0),o(l,E),E.onreadystatechange=function(){if(E.readyState===n){var _=E.status;if(_===0){d(new Error("Request error"));return}var g=a(E),h={statusCode:E.status,body:E.responseText,headers:g};c(h)}},E.timeout=G.REQUEST_TIMEOUT_MS,E.ontimeout=function(){r.error("Request timed out")},E.send()});return{responsePromise:p,abort:function(){E.abort()}}}t.makeGetRequest=s});C(ot),ot.makeGetRequest;var Ft=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.listeners={},this.listenerId=1}return i.prototype.on=function(n,a){var o=this;this.listeners[n]||(this.listeners[n]={});var s=String(this.listenerId);return this.listenerId++,this.listeners[n][s]=a,function(){o.listeners[n]&&delete o.listeners[n][s]}},i.prototype.emit=function(n,a){var o=this.listeners[n];o&&Object.keys(o).forEach(function(s){var u=o[s];u(a)})},i.prototype.removeAllListeners=function(){this.listeners={}},i}();t.default=r});C(Ft);var kt=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function r(){return Math.round(Math.random()*1e3)}var i=function(){function n(){this.errorCount=0}return n.prototype.getDelay=function(){if(this.errorCount===0)return 0;var a=G.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT[Math.min(G.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1,this.errorCount)];return a*1e3+r()},n.prototype.countError=function(){this.errorCount<G.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1&&this.errorCount++},n.prototype.reset=function(){this.errorCount=0},n}();t.default=i});C(kt);var wt=b(function(e,t){var r=w&&w.__assign||function(){return r=Object.assign||function(c){for(var d,_=1,g=arguments.length;_<g;_++){d=arguments[_];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(c[h]=d[h])}return c},r.apply(this,arguments)},i=w&&w.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(Ft),a=i(kt),o=j.getLogger("DatafileManager"),s="update";function u(c){return c>=G.MIN_UPDATE_INTERVAL}function l(c){return c>=200&&c<400}var E={get:function(){return Promise.resolve(null)},set:function(){return Promise.resolve()},contains:function(){return Promise.resolve(!1)},remove:function(){return Promise.resolve()}},p=function(){function c(d){var _=this,g=r({},this.getConfigDefaults(),d),h=g.datafile,I=g.autoUpdate,T=I===void 0?!1:I,X=g.sdkKey,Ie=g.updateInterval,yt=Ie===void 0?G.DEFAULT_UPDATE_INTERVAL:Ie,Mr=g.urlTemplate,Si=Mr===void 0?G.DEFAULT_URL_TEMPLATE:Mr,xr=g.cache,Li=xr===void 0?E:xr;this.cache=Li,this.cacheKey="opt-datafile-"+X,this.isReadyPromiseSettled=!1,this.readyPromiseResolver=function(){},this.readyPromiseRejecter=function(){},this.readyPromise=new Promise(function(Ui,Di){_.readyPromiseResolver=Ui,_.readyPromiseRejecter=Di}),h?(this.currentDatafile=h,X||this.resolveReadyPromise()):this.currentDatafile=null,this.isStarted=!1,this.datafileUrl=V.sprintf(Si,X),this.emitter=new n.default,this.autoUpdate=T,u(yt)?this.updateInterval=yt:(o.warn("Invalid updateInterval %s, defaulting to %s",yt,G.DEFAULT_UPDATE_INTERVAL),this.updateInterval=G.DEFAULT_UPDATE_INTERVAL),this.currentTimeout=null,this.currentRequest=null,this.backoffController=new a.default,this.syncOnCurrentRequestComplete=!1}return c.prototype.get=function(){return this.currentDatafile},c.prototype.start=function(){this.isStarted||(o.debug("Datafile manager started"),this.isStarted=!0,this.backoffController.reset(),this.setDatafileFromCacheIfAvailable(),this.syncDatafile())},c.prototype.stop=function(){return o.debug("Datafile manager stopped"),this.isStarted=!1,this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.emitter.removeAllListeners(),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),Promise.resolve()},c.prototype.onReady=function(){return this.readyPromise},c.prototype.on=function(d,_){return this.emitter.on(d,_)},c.prototype.onRequestRejected=function(d){!this.isStarted||(this.backoffController.countError(),d instanceof Error?o.error("Error fetching datafile: %s",d.message,d):typeof d=="string"?o.error("Error fetching datafile: %s",d):o.error("Error fetching datafile"))},c.prototype.onRequestResolved=function(d){if(!!this.isStarted){typeof d.statusCode!="undefined"&&l(d.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(d.headers);var _=this.getNextDatafileFromResponse(d);if(_!==null)if(o.info("Updating datafile from response"),this.currentDatafile=_,this.cache.set(this.cacheKey,_),!this.isReadyPromiseSettled)this.resolveReadyPromise();else{var g={datafile:_};this.emitter.emit(s,g)}}},c.prototype.onRequestComplete=function(){!this.isStarted||(this.currentRequest=null,!this.isReadyPromiseSettled&&!this.autoUpdate&&this.rejectReadyPromise(new Error("Failed to become ready")),this.autoUpdate&&this.syncOnCurrentRequestComplete&&this.syncDatafile(),this.syncOnCurrentRequestComplete=!1)},c.prototype.syncDatafile=function(){var d=this,_={};this.lastResponseLastModified&&(_["if-modified-since"]=this.lastResponseLastModified),o.debug("Making datafile request to url %s with headers: %s",this.datafileUrl,function(){return JSON.stringify(_)}),this.currentRequest=this.makeGetRequest(this.datafileUrl,_);var g=function(){d.onRequestComplete()},h=function(T){d.onRequestResolved(T)},I=function(T){d.onRequestRejected(T)};this.currentRequest.responsePromise.then(h,I).then(g,g),this.autoUpdate&&this.scheduleNextUpdate()},c.prototype.resolveReadyPromise=function(){this.readyPromiseResolver(),this.isReadyPromiseSettled=!0},c.prototype.rejectReadyPromise=function(d){this.readyPromiseRejecter(d),this.isReadyPromiseSettled=!0},c.prototype.scheduleNextUpdate=function(){var d=this,_=this.backoffController.getDelay(),g=Math.max(_,this.updateInterval);o.debug("Scheduling sync in %s ms",g),this.currentTimeout=setTimeout(function(){d.currentRequest?d.syncOnCurrentRequestComplete=!0:d.syncDatafile()},g)},c.prototype.getNextDatafileFromResponse=function(d){return o.debug("Response status code: %s",d.statusCode),typeof d.statusCode=="undefined"||d.statusCode===304?null:l(d.statusCode)?this.tryParsingBodyAsJSON(d.body):null},c.prototype.tryParsingBodyAsJSON=function(d){var _;try{_=JSON.parse(d)}catch(h){return o.error("Error parsing response body: %s",h.message,h),null}var g=null;return typeof _=="object"&&_!==null?g=_:o.error("Error parsing response body: was not an object"),g},c.prototype.trySavingLastModified=function(d){var _=d["last-modified"]||d["Last-Modified"];typeof _!="undefined"&&(this.lastResponseLastModified=_,o.debug("Saved last modified header value from response: %s",this.lastResponseLastModified))},c.prototype.setDatafileFromCacheIfAvailable=function(){var d=this;this.cache.get(this.cacheKey).then(function(_){d.isStarted&&!d.isReadyPromiseSettled&&_&&(o.debug("Using datafile from cache"),d.currentDatafile=_,d.resolveReadyPromise())})},c}();t.default=p});C(wt);var Bt=b(function(e,t){var r=w&&w.__extends||function(){var o=function(s,u){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,E){l.__proto__=E}||function(l,E){for(var p in E)E.hasOwnProperty(p)&&(l[p]=E[p])},o(s,u)};return function(s,u){o(s,u);function l(){this.constructor=s}s.prototype=u===null?Object.create(u):(l.prototype=u.prototype,new l)}}(),i=w&&w.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});var n=i(wt),a=function(o){r(s,o);function s(){return o!==null&&o.apply(this,arguments)||this}return s.prototype.makeGetRequest=function(u,l){return ot.makeGetRequest(u,l)},s.prototype.getConfigDefaults=function(){return{autoUpdate:!1}},s}(n.default);t.default=a});C(Bt);var Gt=b(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HttpPollingDatafileManager=Bt.default});C(Gt);var In=Gt.HttpPollingDatafileManager,mn=Math.pow(2,53),at=function(e){return typeof e=="number"&&Math.abs(e)<=mn},K=function(e){if(!e)return{};if(typeof Object.assign=="function")return Object.assign.apply(Object,arguments);for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(i!=null)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},De=function(){return Math.round(new Date().getTime())},J=at,H=function(e,t){return e?fn(e,function(r){return r[t]}):{}},be=function(){return Vt.v4()},ie=function(e){return typeof e=="number"},v={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},S={CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},O={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_KEY_NOT_FOUND:"%s: Event key %s is not in datafile.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",USER_ASSIGNED_TO_VARIATION_BUCKET:"%s: Assigned variation bucket %s to user %s.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned experiment bucket %s to user %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s bucketed into everyone targeting rule.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning default value for variable "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Value for variable "%s" of feature flag "%s" is %s for user "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for experiment "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for experiment %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},st={REVENUE:"revenue",VALUE:"value"},Ce=dn,Pe={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string"},Ve={V2:"2",V3:"3",V4:"4"},L={LOG_LEVEL:v,ERROR_MESSAGES:S,LOG_MESSAGES:O,RESERVED_EVENT_KEYWORDS:st,CONTROL_ATTRIBUTES:{BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent"},JAVASCRIPT_CLIENT_ENGINE:"javascript-sdk",NODE_CLIENT_ENGINE:"node-sdk",REACT_CLIENT_ENGINE:"react-sdk",NODE_CLIENT_VERSION:"4.0.0",VALID_CLIENT_ENGINES:["node-sdk","react-sdk","javascript-sdk"],NOTIFICATION_TYPES:Ce,DECISION_NOTIFICATION_TYPES:{AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable"},DECISION_SOURCES:{FEATURE_TEST:"feature-test",ROLLOUT:"rollout"},FEATURE_VARIABLE_TYPES:Pe,DATAFILE_VERSIONS:Ve},oe="CONFIG_VALIDATOR",yn=[Ve.V2,Ve.V3,Ve.V4],Rn=function(e){if(e.errorHandler&&typeof e.errorHandler.handleError!="function")throw new Error(f(S.INVALID_ERROR_HANDLER,oe));if(e.eventDispatcher&&typeof e.eventDispatcher.dispatchEvent!="function")throw new Error(f(S.INVALID_EVENT_DISPATCHER,oe));if(e.logger&&typeof e.logger.log!="function")throw new Error(f(S.INVALID_LOGGER,oe));return!0},Kt=function(e){if(!e)throw new Error(f(S.NO_DATAFILE_SPECIFIED,oe));if(typeof e=="string"||e instanceof String)try{e=JSON.parse(e)}catch(t){throw new Error(f(S.INVALID_DATAFILE_MALFORMED,oe))}if(yn.indexOf(e.version)===-1)throw new Error(f(S.INVALID_DATAFILE_VERSION,oe,e.version));return!0},Tn={handleError:function(){}},On=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},jt={dispatchEvent:function(e,t){var r,i=e.url,n=e.params;e.httpVerb==="POST"?((r=new XMLHttpRequest).open("POST",i,!0),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=function(){if(r.readyState===4&&t&&typeof t=="function")try{t(n)}catch(a){}},r.send(JSON.stringify(n))):(i+="?wxhr=true",n&&(i+="&"+On(n)),(r=new XMLHttpRequest).open("GET",i,!0),r.onreadystatechange=function(){if(r.readyState===4&&t&&typeof t=="function")try{t()}catch(a){}},r.send())}};function Ht(){}Ht.prototype.log=function(){};var qt={createLogger:function(e){return new En(e)},createNoOpLogger:function(){return new Ht}},Nn=function(e){if(typeof e!="object"||Array.isArray(e)||e===null)throw new Error(f(S.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));return Object.keys(e).forEach(function(t){if(e[t]===void 0)throw new Error(f(S.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",t))}),!0},Yt=function(e,t){return typeof e=="string"&&(typeof t=="string"||typeof t=="boolean"||ie(t)&&J(t))},An=Math.pow(2,32),Me={bucket:function(e){var t=e.experimentKeyMap[e.experimentKey].groupId;if(t){var r=e.groupIdMap[t];if(!r)throw new Error(f(S.INVALID_GROUP_ID,"BUCKETER",t));if(r.policy==="random"){var i=this.bucketUserIntoExperiment(r,e.bucketingId,e.userId,e.logger);if(i===null){var n=f(O.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",e.userId,t);return e.logger.log(v.INFO,n),null}if(i!==e.experimentId){var a=f(O.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,t);return e.logger.log(v.INFO,a),null}var o=f(O.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,t);e.logger.log(v.INFO,o)}}var s=f("%s%s",e.bucketingId,e.experimentId),u=this._generateBucketValue(s),l=f(O.USER_ASSIGNED_TO_VARIATION_BUCKET,"BUCKETER",u,e.userId);e.logger.log(v.DEBUG,l);var E=this._findBucket(u,e.trafficAllocationConfig);if(E){if(!e.variationIdMap.hasOwnProperty(E)){var p=f(O.INVALID_VARIATION_ID,"BUCKETER");return e.logger.log(v.WARNING,p),null}var c=e.variationIdMap[E].key,d=f(O.USER_HAS_VARIATION,"BUCKETER",e.userId,c,e.experimentKey);e.logger.log(v.INFO,d)}else{var _=f(O.USER_HAS_NO_VARIATION,"BUCKETER",e.userId,e.experimentKey);e.logger.log(v.DEBUG,_)}return E},bucketUserIntoExperiment:function(e,t,r,i){var n=f("%s%s",t,e.id),a=this._generateBucketValue(n);i.log(v.DEBUG,f(O.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",a,r));var o=e.trafficAllocation;return this._findBucket(a,o)},_findBucket:function(e,t){for(var r=0;r<t.length;r++)if(e<t[r].endOfRange)return t[r].entityId;return null},_generateBucketValue:function(e){try{var t=vn.v3(e,1);return parseInt(1e4*(t/An),10)}catch(r){throw new Error(f(S.INVALID_BUCKETING_ID,"BUCKETER",e,r.message))}}},F="PROJECT_CONFIG",Wt=function(e,t){return e.experimentFeatureMap.hasOwnProperty(t)},N={createProjectConfig:function(e){var t=function(r){var i=K({},r);return i.audiences=(r.audiences||[]).map(function(n){return K({},n)}),i.experiments=(r.experiments||[]).map(function(n){return K({},n)}),i.featureFlags=(r.featureFlags||[]).map(function(n){return K({},n)}),i.groups=(r.groups||[]).map(function(n){var a=K({},n);return a.experiments=(n.experiments||[]).map(function(o){return K({},o)}),a}),i.rollouts=(r.rollouts||[]).map(function(n){var a=K({},n);return a.experiments=(n.experiments||[]).map(function(o){return K({},o)}),a}),i}(e);return(t.audiences||[]).forEach(function(r){r.conditions=JSON.parse(r.conditions)}),t.audiencesById=H(t.audiences,"id"),K(t.audiencesById,H(t.typedAudiences,"id")),t.attributeKeyMap=H(t.attributes,"key"),t.eventKeyMap=H(t.events,"key"),t.groupIdMap=H(t.groups,"id"),Object.keys(t.groupIdMap||{}).forEach(function(r){(t.groupIdMap[r].experiments||[]).forEach(function(i){t.experiments.push(K(i,{groupId:r}))})}),t.rolloutIdMap=H(t.rollouts||[],"id"),ee(t.rolloutIdMap||{}).forEach(function(r){(r.experiments||[]).forEach(function(i){t.experiments.push(i),i.variationKeyMap=H(i.variations,"key")})}),t.experimentKeyMap=H(t.experiments,"key"),t.experimentIdMap=H(t.experiments,"id"),t.variationIdMap={},t.variationVariableUsageMap={},(t.experiments||[]).forEach(function(r){r.variationKeyMap=H(r.variations,"key"),K(t.variationIdMap,H(r.variations,"id")),ee(r.variationKeyMap||{}).forEach(function(i){i.variables&&(t.variationVariableUsageMap[i.id]=H(i.variables,"id"))})}),t.experimentFeatureMap={},t.featureKeyMap=H(t.featureFlags||[],"key"),ee(t.featureKeyMap||{}).forEach(function(r){r.variableKeyMap=H(r.variables,"key"),(r.experimentIds||[]).forEach(function(i){t.experimentFeatureMap[i]?t.experimentFeatureMap[i].push(r.id):t.experimentFeatureMap[i]=[r.id];var n=t.experimentIdMap[i];n.groupId&&!r.groupId&&(r.groupId=n.groupId)})}),t},getExperimentId:function(e,t){var r=e.experimentKeyMap[t];if(!r)throw new Error(f(S.INVALID_EXPERIMENT_KEY,F,t));return r.id},getLayerId:function(e,t){var r=e.experimentIdMap[t];if(!r)throw new Error(f(S.INVALID_EXPERIMENT_ID,F,t));return r.layerId},getAttributeId:function(e,t,r){var i=e.attributeKeyMap[t],n=t.indexOf("$opt_")===0;return i?(n&&r.log(v.WARN,f("Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",t,"$opt_")),i.id):n?t:(r.log(v.DEBUG,f(S.UNRECOGNIZED_ATTRIBUTE,F,t)),null)},getEventId:function(e,t){var r=e.eventKeyMap[t];return r?r.id:null},getExperimentStatus:function(e,t){var r=e.experimentKeyMap[t];if(!r)throw new Error(f(S.INVALID_EXPERIMENT_KEY,F,t));return r.status},isActive:function(e,t){return this.getExperimentStatus(e,t)==="Running"},isRunning:function(e,t){return this.getExperimentStatus(e,t)==="Running"},getExperimentAudienceConditions:function(e,t){var r=e.experimentKeyMap[t];if(!r)throw new Error(f(S.INVALID_EXPERIMENT_KEY,F,t));return r.audienceConditions||r.audienceIds},getVariationKeyFromId:function(e,t){return e.variationIdMap.hasOwnProperty(t)?e.variationIdMap[t].key:null},getVariationIdFromExperimentAndVariationKey:function(e,t,r){var i=e.experimentKeyMap[t];return i.variationKeyMap.hasOwnProperty(r)?i.variationKeyMap[r].id:null},getExperimentFromKey:function(e,t){if(e.experimentKeyMap.hasOwnProperty(t)){var r=e.experimentKeyMap[t];if(r)return r}throw new Error(f(S.EXPERIMENT_KEY_NOT_IN_DATAFILE,F,t))},getTrafficAllocation:function(e,t){var r=e.experimentKeyMap[t];if(!r)throw new Error(f(S.INVALID_EXPERIMENT_KEY,F,t));return r.trafficAllocation},getExperimentFromId:function(e,t,r){if(e.experimentIdMap.hasOwnProperty(t)){var i=e.experimentIdMap[t];if(i)return i}return r.log(v.ERROR,f(S.INVALID_EXPERIMENT_ID,F,t)),null},getFeatureFromKey:function(e,t,r){if(e.featureKeyMap.hasOwnProperty(t)){var i=e.featureKeyMap[t];if(i)return i}return r.log(v.ERROR,f(S.FEATURE_NOT_IN_DATAFILE,F,t)),null},getVariableForFeature:function(e,t,r,i){var n=e.featureKeyMap[t];if(!n)return i.log(v.ERROR,f(S.FEATURE_NOT_IN_DATAFILE,F,t)),null;var a=n.variableKeyMap[r];return a||(i.log(v.ERROR,f(S.VARIABLE_KEY_NOT_IN_DATAFILE,F,r,t)),null)},getVariableValueForVariation:function(e,t,r,i){if(!t||!r)return null;if(!e.variationVariableUsageMap.hasOwnProperty(r.id))return i.log(v.ERROR,f(S.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,F,r.id)),null;var n=e.variationVariableUsageMap[r.id][t.id];return n?n.value:null},getTypeCastValue:function(e,t,r){var i;switch(t){case Pe.BOOLEAN:e!=="true"&&e!=="false"?(r.log(v.ERROR,f(S.UNABLE_TO_CAST_VALUE,F,e,t)),i=null):i=e==="true";break;case Pe.INTEGER:i=parseInt(e,10),isNaN(i)&&(r.log(v.ERROR,f(S.UNABLE_TO_CAST_VALUE,F,e,t)),i=null);break;case Pe.DOUBLE:i=parseFloat(e),isNaN(i)&&(r.log(v.ERROR,f(S.UNABLE_TO_CAST_VALUE,F,e,t)),i=null);break;default:i=e}return i},getAudiencesById:function(e){return e.audiencesById},eventWithKeyExists:function(e,t){return e.eventKeyMap.hasOwnProperty(t)},isFeatureExperiment:Wt,tryCreatingProjectConfig:function(e){return Kt(e.datafile),e.jsonSchemaValidator?(e.jsonSchemaValidator.validate(e.datafile),e.logger.log(v.INFO,f(O.VALID_DATAFILE,F))):e.logger.log(v.INFO,f(O.SKIPPING_JSON_VALIDATION,F)),this.createProjectConfig(e.datafile)}},Sn=["and","or","not"],xe=function(e,t){if(Array.isArray(e)){var r=e[0],i=e.slice(1);switch(Sn.indexOf(r)===-1&&(r="or",i=e),r){case"and":return function(n,a){for(var o=!1,s=0;s<n.length;s++){var u=xe(n[s],a);if(u===!1)return!1;u===null&&(o=!0)}return!o||null}(i,t);case"not":return function(n,a){if(n.length>0){var o=xe(n[0],a);return o===null?null:!o}return null}(i,t);default:return function(n,a){for(var o=!1,s=0;s<n.length;s++){var u=xe(n[s],a);if(u===!0)return!0;u===null&&(o=!0)}return!!o&&null}(i,t)}}return t(e)},zt=xe,k="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",Ln=["exact","exists","gt","lt","substring"],ae={};ae.exact=$t,ae.exists=function(e,t){var r=t[e.name];return r!=null},ae.gt=function(e,t,r){var i=e.name,n=t[i],a=typeof n,o=e.value;return J(o)?n===null?(r.log(v.DEBUG,f(O.UNEXPECTED_TYPE_NULL,k,JSON.stringify(e),i)),null):ie(n)?J(n)?n>o:(r.log(v.WARNING,f(O.OUT_OF_BOUNDS,k,JSON.stringify(e),i)),null):(r.log(v.WARNING,f(O.UNEXPECTED_TYPE,k,JSON.stringify(e),a,i)),null):(r.log(v.WARNING,f(O.UNEXPECTED_CONDITION_VALUE,k,JSON.stringify(e))),null)},ae.lt=function(e,t,r){var i=e.name,n=t[e.name],a=typeof n,o=e.value;return J(o)?n===null?(r.log(v.DEBUG,f(O.UNEXPECTED_TYPE_NULL,k,JSON.stringify(e),i)),null):ie(n)?J(n)?n<o:(r.log(v.WARNING,f(O.OUT_OF_BOUNDS,k,JSON.stringify(e),i)),null):(r.log(v.WARNING,f(O.UNEXPECTED_TYPE,k,JSON.stringify(e),a,i)),null):(r.log(v.WARNING,f(O.UNEXPECTED_CONDITION_VALUE,k,JSON.stringify(e))),null)},ae.substring=function(e,t,r){var i=e.name,n=t[e.name],a=typeof n,o=e.value;return typeof o!="string"?(r.log(v.WARNING,f(O.UNEXPECTED_CONDITION_VALUE,k,JSON.stringify(e))),null):n===null?(r.log(v.DEBUG,f(O.UNEXPECTED_TYPE_NULL,k,JSON.stringify(e),i)),null):typeof n!="string"?(r.log(v.WARNING,f(O.UNEXPECTED_TYPE,k,JSON.stringify(e),a,i)),null):n.indexOf(o)!==-1};function Xt(e){return typeof e=="string"||typeof e=="boolean"||ie(e)}function $t(e,t,r){var i=e.value,n=typeof i,a=e.name,o=t[a],s=typeof o;return!Xt(i)||ie(i)&&!J(i)?(r.log(v.WARNING,f(O.UNEXPECTED_CONDITION_VALUE,k,JSON.stringify(e))),null):o===null?(r.log(v.DEBUG,f(O.UNEXPECTED_TYPE_NULL,k,JSON.stringify(e),a)),null):Xt(o)&&n===s?ie(o)&&!J(o)?(r.log(v.WARNING,f(O.OUT_OF_BOUNDS,k,JSON.stringify(e),a)),null):i===o:(r.log(v.WARNING,f(O.UNEXPECTED_TYPE,k,JSON.stringify(e),s,a)),null)}var Un={evaluate:function(e,t,r){var i=e.match;if(i!==void 0&&Ln.indexOf(i)===-1)return r.log(v.WARNING,f(O.UNKNOWN_MATCH_TYPE,k,JSON.stringify(e))),null;var n=e.name;return t.hasOwnProperty(n)||i=="exists"?(ae[i]||$t)(e,t,r):(r.log(v.DEBUG,f(O.MISSING_ATTRIBUTE_VALUE,k,JSON.stringify(e),n)),null)}},Ee=Ne();function ut(e){this.typeToEvaluatorMap=K({},e,{custom_attribute:Un})}ut.prototype.evaluate=function(e,t,r){if(!e||e.length===0)return!0;r||(r={});var i=function(n){var a=t[n];if(a){Ee.log(v.DEBUG,f(O.EVALUATING_AUDIENCE,"AUDIENCE_EVALUATOR",n,JSON.stringify(a.conditions)));var o=zt(a.conditions,this.evaluateConditionWithUserAttributes.bind(this,r)),s=o===null?"UNKNOWN":o.toString().toUpperCase();return Ee.log(v.INFO,f(O.AUDIENCE_EVALUATION_RESULT,"AUDIENCE_EVALUATOR",n,s)),o}return null}.bind(this);return zt(e,i)||!1},ut.prototype.evaluateConditionWithUserAttributes=function(e,t){var r=this.typeToEvaluatorMap[t.type];if(!r)return Ee.log(v.WARNING,f(O.UNKNOWN_CONDITION_TYPE,"AUDIENCE_EVALUATOR",JSON.stringify(t))),null;try{return r.evaluate(t,e,Ee)}catch(i){Ee.log(v.ERROR,f(S.CONDITION_EVALUATOR_ERROR,"AUDIENCE_EVALUATOR",t.type,i.message))}return null};var Jt=function(e){return typeof e=="string"&&e!==""},R="DECISION_SERVICE",W=L.ERROR_MESSAGES,m=L.LOG_LEVEL,A=L.LOG_MESSAGES,te=L.DECISION_SOURCES;function M(e){this.audienceEvaluator=new ut(e.UNSTABLE_conditionEvaluators),this.forcedVariationMap={},this.logger=e.logger,this.userProfileService=e.userProfileService||null}M.prototype.getVariation=function(e,t,r,i){var n=this._getBucketingId(r,i);if(!this.__checkIfExperimentIsActive(e,t))return null;var a=e.experimentKeyMap[t],o=this.getForcedVariation(e,t,r);if(o)return o;var s=this.__getWhitelistedVariation(a,r);if(s)return s.key;var u=this.__resolveExperimentBucketMap(r,i);if(s=this.__getStoredVariation(e,a,r,u))return this.logger.log(m.INFO,f(A.RETURNING_STORED_VARIATION,R,s.key,t,r)),s.key;if(!this.__checkIfUserIsInAudience(e,t,r,i))return null;var l=this.__buildBucketerParams(e,t,n,r),E=Me.bucket(l);return(s=e.variationIdMap[E])?(this.__saveUserProfile(a,s,r,u),s.key):null},M.prototype.__resolveExperimentBucketMap=function(e,t){t=t||{};var r=this.__getUserProfile(e)||{},i=t[L.CONTROL_ATTRIBUTES.STICKY_BUCKETING_KEY];return K({},r.experiment_bucket_map,i)},M.prototype.__checkIfExperimentIsActive=function(e,t){if(!N.isActive(e,t)){var r=f(A.EXPERIMENT_NOT_RUNNING,R,t);return this.logger.log(m.INFO,r),!1}return!0},M.prototype.__getWhitelistedVariation=function(e,t){if(e.forcedVariations&&e.forcedVariations.hasOwnProperty(t)){var r=e.forcedVariations[t];if(e.variationKeyMap.hasOwnProperty(r)){var i=f(A.USER_FORCED_IN_VARIATION,R,t,r);return this.logger.log(m.INFO,i),e.variationKeyMap[r]}var n=f(A.FORCED_BUCKETING_FAILED,R,r,t);return this.logger.log(m.ERROR,n),null}return null},M.prototype.__checkIfUserIsInAudience=function(e,t,r,i){var n=N.getExperimentAudienceConditions(e,t),a=N.getAudiencesById(e);this.logger.log(m.DEBUG,f(A.EVALUATING_AUDIENCES_COMBINED,R,t,JSON.stringify(n)));var o=this.audienceEvaluator.evaluate(n,a,i);if(this.logger.log(m.INFO,f(A.AUDIENCE_EVALUATION_RESULT_COMBINED,R,t,o.toString().toUpperCase())),!o){var s=f(A.USER_NOT_IN_EXPERIMENT,R,r,t);return this.logger.log(m.INFO,s),!1}return!0},M.prototype.__buildBucketerParams=function(e,t,r,i){var n={};return n.experimentKey=t,n.experimentId=N.getExperimentId(e,t),n.userId=i,n.trafficAllocationConfig=N.getTrafficAllocation(e,t),n.experimentKeyMap=e.experimentKeyMap,n.groupIdMap=e.groupIdMap,n.variationIdMap=e.variationIdMap,n.logger=this.logger,n.bucketingId=r,n},M.prototype.__getStoredVariation=function(e,t,r,i){if(i.hasOwnProperty(t.id)){var n=i[t.id],a=n.variation_id;if(e.variationIdMap.hasOwnProperty(a))return e.variationIdMap[n.variation_id];this.logger.log(m.INFO,f(A.SAVED_VARIATION_NOT_FOUND,R,r,a,t.key))}return null},M.prototype.__getUserProfile=function(e){var t={user_id:e,experiment_bucket_map:{}};if(!this.userProfileService)return t;try{return this.userProfileService.lookup(e)}catch(r){this.logger.log(m.ERROR,f(W.USER_PROFILE_LOOKUP_ERROR,R,e,r.message))}},M.prototype.__saveUserProfile=function(e,t,r,i){if(this.userProfileService)try{i[e.id]={variation_id:t.id},this.userProfileService.save({user_id:r,experiment_bucket_map:i}),this.logger.log(m.INFO,f(A.SAVED_VARIATION,R,t.key,e.key,r))}catch(n){this.logger.log(m.ERROR,f(W.USER_PROFILE_SAVE_ERROR,R,r,n.message))}},M.prototype.getVariationForFeature=function(e,t,r,i){var n=this._getVariationForFeatureExperiment(e,t,r,i);if(n.variation!==null)return this.logger.log(m.DEBUG,f(A.USER_IN_FEATURE_EXPERIMENT,R,r,n.variation.key,n.experiment.key,t.key)),n;this.logger.log(m.DEBUG,f(A.USER_NOT_IN_FEATURE_EXPERIMENT,R,r,t.key));var a=this._getVariationForRollout(e,t,r,i);return a.variation!==null?(this.logger.log(m.DEBUG,f(A.USER_IN_ROLLOUT,R,r,t.key)),a):(this.logger.log(m.DEBUG,f(A.USER_NOT_IN_ROLLOUT,R,r,t.key)),a)},M.prototype._getVariationForFeatureExperiment=function(e,t,r,i){var n=null,a=null;if(t.hasOwnProperty("groupId")){var o=e.groupIdMap[t.groupId];o&&(n=this._getExperimentInGroup(e,o,r))&&t.experimentIds.indexOf(n.id)!==-1&&(a=this.getVariation(e,n.key,r,i))}else t.experimentIds.length>0?(n=N.getExperimentFromId(e,t.experimentIds[0],this.logger))&&(a=this.getVariation(e,n.key,r,i)):this.logger.log(m.DEBUG,f(A.FEATURE_HAS_NO_EXPERIMENTS,R,t.key));var s=null;return a!==null&&n!==null&&(s=n.variationKeyMap[a]),{experiment:n,variation:s,decisionSource:te.FEATURE_TEST}},M.prototype._getExperimentInGroup=function(e,t,r){var i=Me.bucketUserIntoExperiment(t,r,r,this.logger);if(i){this.logger.log(m.INFO,f(A.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,R,r,i,t.id));var n=N.getExperimentFromId(e,i,this.logger);if(n)return n}return this.logger.log(m.INFO,f(A.USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP,R,r,t.id)),null},M.prototype._getVariationForRollout=function(e,t,r,i){if(!t.rolloutId)return this.logger.log(m.DEBUG,f(A.NO_ROLLOUT_EXISTS,R,t.key)),{experiment:null,variation:null,decisionSource:te.ROLLOUT};var n=e.rolloutIdMap[t.rolloutId];if(!n)return this.logger.log(m.ERROR,f(W.INVALID_ROLLOUT_ID,R,t.rolloutId,t.key)),{experiment:null,variation:null,decisionSource:te.ROLLOUT};if(n.experiments.length===0)return this.logger.log(m.ERROR,f(A.ROLLOUT_HAS_NO_EXPERIMENTS,R,t.rolloutId)),{experiment:null,variation:null,decisionSource:te.ROLLOUT};var a,o,s,u,l,E=this._getBucketingId(r,i),p=n.experiments.length-1;for(a=0;a<p;a++){if(o=e.experimentKeyMap[n.experiments[a].key],this.__checkIfUserIsInAudience(e,o.key,r,i)){if(this.logger.log(m.DEBUG,f(A.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,R,r,a+1)),s=this.__buildBucketerParams(e,o.key,E,r),u=Me.bucket(s),l=e.variationIdMap[u])return this.logger.log(m.DEBUG,f(A.USER_BUCKETED_INTO_TARGETING_RULE,R,r,a+1)),{experiment:o,variation:l,decisionSource:te.ROLLOUT};this.logger.log(m.DEBUG,f(A.USER_NOT_BUCKETED_INTO_TARGETING_RULE,R,r,a+1));break}this.logger.log(m.DEBUG,f(A.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,R,r,a+1))}var c=e.experimentKeyMap[n.experiments[p].key];if(this.__checkIfUserIsInAudience(e,c.key,r,i)){if(s=this.__buildBucketerParams(e,c.key,E,r),u=Me.bucket(s),l=e.variationIdMap[u])return this.logger.log(m.DEBUG,f(A.USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE,R,r)),{experiment:c,variation:l,decisionSource:te.ROLLOUT};this.logger.log(m.DEBUG,f(A.USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE,R,r))}return{experiment:null,variation:null,decisionSource:te.ROLLOUT}},M.prototype._getBucketingId=function(e,t){var r=e;return t!=null&&typeof t=="object"&&t.hasOwnProperty(L.CONTROL_ATTRIBUTES.BUCKETING_ID)&&(typeof t[L.CONTROL_ATTRIBUTES.BUCKETING_ID]=="string"?(r=t[L.CONTROL_ATTRIBUTES.BUCKETING_ID],this.logger.log(m.DEBUG,f(A.VALID_BUCKETING_ID,R,r))):this.logger.log(m.WARNING,f(A.BUCKETING_ID_NOT_STRING,R))),r},M.prototype.removeForcedVariation=function(e,t,r){if(!e)throw new Error(f(W.INVALID_USER_ID,R));if(!this.forcedVariationMap.hasOwnProperty(e))throw new Error(f(W.USER_NOT_IN_FORCED_VARIATION,R,e));delete this.forcedVariationMap[e][t],this.logger.log(m.DEBUG,f(A.VARIATION_REMOVED_FOR_USER,R,r,e))},M.prototype.__setInForcedVariationMap=function(e,t,r){this.forcedVariationMap.hasOwnProperty(e)||(this.forcedVariationMap[e]={}),this.forcedVariationMap[e][t]=r,this.logger.log(m.DEBUG,f(A.USER_MAPPED_TO_FORCED_VARIATION,R,r,t,e))},M.prototype.getForcedVariation=function(e,t,r){var i,n=this.forcedVariationMap[r];if(!n)return this.logger.log(m.DEBUG,f(A.USER_HAS_NO_FORCED_VARIATION,R,r)),null;try{var a=N.getExperimentFromKey(e,t);if(!a.hasOwnProperty("id"))return this.logger.log(m.ERROR,f(W.IMPROPERLY_FORMATTED_EXPERIMENT,R,t)),null;i=a.id}catch(u){return this.logger.log(m.ERROR,u.message),null}var o=n[i];if(!o)return this.logger.log(m.DEBUG,f(A.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,R,t,r)),null;var s=N.getVariationKeyFromId(e,o);return s?this.logger.log(m.DEBUG,f(A.USER_HAS_FORCED_VARIATION,R,s,t,r)):this.logger.log(m.DEBUG,f(A.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,R,t,r)),s},M.prototype.setForcedVariation=function(e,t,r,i){if(i!=null&&!Jt(i))return this.logger.log(m.ERROR,f(W.INVALID_VARIATION_KEY,R)),!1;var n;try{var a=N.getExperimentFromKey(e,t);if(!a.hasOwnProperty("id"))return this.logger.log(m.ERROR,f(W.IMPROPERLY_FORMATTED_EXPERIMENT,R,t)),!1;n=a.id}catch(s){return this.logger.log(m.ERROR,s.message),!1}if(i==null)try{return this.removeForcedVariation(r,n,t,this.logger),!0}catch(s){return this.logger.log(m.ERROR,s.message),!1}var o=N.getVariationIdFromExperimentAndVariationKey(e,t,i);if(!o)return this.logger.log(m.ERROR,f(W.NO_VARIATION_FOR_EXPERIMENT_KEY,R,i,t)),!1;try{return this.__setInForcedVariationMap(r,n,o),!0}catch(s){return this.logger.log(m.ERROR,s.message),!1}};var Dn=function(e){return new M(e)},Zt=st.REVENUE,Qt=st.VALUE,er=function(e,t){if(e&&e.hasOwnProperty(Zt)){var r=e[Zt],i=parseInt(r,10);return isNaN(i)?(t.log(v.INFO,f(O.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",r)),null):(t.log(v.INFO,f(O.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",i)),i)}return null},tr=function(e,t){if(e&&e.hasOwnProperty(Qt)){var r=e[Qt],i=parseFloat(r);return isNaN(i)?(t.log(v.INFO,f(O.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",r)),null):(t.log(v.INFO,f(O.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",i)),i)}return null},rr="https://logx.optimizely.com/v1/events";function nr(e){var t=e.attributes,r=e.configObj,i=r.anonymizeIP,n=r.botFiltering;i==null&&(i=!1);var a={snapshots:[],visitor_id:e.userId,attributes:[]},o={account_id:r.accountId,project_id:r.projectId,visitors:[a],revision:r.revision,client_name:e.clientEngine,client_version:e.clientVersion,anonymize_ip:i,enrich_decisions:!0};return Object.keys(t||{}).forEach(function(s){var u=t[s];if(Yt(s,u)){var l=N.getAttributeId(e.configObj,s,e.logger);l&&o.visitors[0].attributes.push({entity_id:l,key:s,type:"custom",value:t[s]})}}),typeof n=="boolean"&&o.visitors[0].attributes.push({entity_id:L.CONTROL_ATTRIBUTES.BOT_FILTERING,key:L.CONTROL_ATTRIBUTES.BOT_FILTERING,type:"custom",value:n}),o}var bn=function(e){var t={httpVerb:"POST"},r=nr(e);t.url=rr;var i,n,a,o=(i=e.configObj,n=e.experimentId,a=e.variationId,{decisions:[{campaign_id:N.getLayerId(i,n),experiment_id:n,variation_id:a}],events:[{entity_id:N.getLayerId(i,n),timestamp:De(),key:"campaign_activated",uuid:be()}]});return r.visitors[0].snapshots.push(o),t.params=r,t},Cn=function(e){var t={httpVerb:"POST"},r=nr(e);t.url=rr;var i=function(n,a,o,s){var u={events:[]},l={entity_id:N.getEventId(n,a),timestamp:De(),uuid:be(),key:a};if(o){var E=er(o,s);E!==null&&(l[L.RESERVED_EVENT_KEYWORDS.REVENUE]=E);var p=tr(o,s);p!==null&&(l[L.RESERVED_EVENT_KEYWORDS.VALUE]=p),l.tags=o}return u.events.push(l),u}(e.configObj,e.eventKey,e.eventTags,e.logger);return r.visitors[0].snapshots=[i],t.params=r,t},lt=Ne("EVENT_BUILDER");function ir(e,t){var r=[];return Object.keys(t||{}).forEach(function(i){var n=t[i];if(Yt(i,n)){var a=N.getAttributeId(e,i,lt);a&&r.push({entityId:a,key:i,value:t[i]})}}),r}var Pn=function(e){if(typeof e!="object"||Array.isArray(e)||e===null)throw new Error(f(S.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"));return!0};function se(e){this.logger=e.logger,this.errorHandler=e.errorHandler,this.__notificationListeners={},ee(Ce).forEach(function(t){this.__notificationListeners[t]=[]}.bind(this)),this.__listenerId=1}se.prototype.addNotificationListener=function(e,t){try{if(!(ee(Ce).indexOf(e)>-1))return-1;this.__notificationListeners[e]||(this.__notificationListeners[e]=[]);var r=!1;if((this.__notificationListeners[e]||[]).forEach(function(n){if(n.callback===t)return r=!0,!1}),r)return-1;this.__notificationListeners[e].push({id:this.__listenerId,callback:t});var i=this.__listenerId;return this.__listenerId+=1,i}catch(n){return this.logger.log(v.ERROR,n.message),this.errorHandler.handleError(n),-1}},se.prototype.removeNotificationListener=function(e){try{var t,r;if(Object.keys(this.__notificationListeners).some(function(i){if((this.__notificationListeners[i]||[]).every(function(n,a){return n.id!==e||(t=a,r=i,!1)}),t!==void 0&&r!==void 0)return!0}.bind(this)),t!==void 0&&r!==void 0)return this.__notificationListeners[r].splice(t,1),!0}catch(i){this.logger.log(v.ERROR,i.message),this.errorHandler.handleError(i)}return!1},se.prototype.clearAllNotificationListeners=function(){try{ee(Ce).forEach(function(e){this.__notificationListeners[e]=[]}.bind(this))}catch(e){this.logger.log(v.ERROR,e.message),this.errorHandler.handleError(e)}},se.prototype.clearNotificationListeners=function(e){try{this.__notificationListeners[e]=[]}catch(t){this.logger.log(v.ERROR,t.message),this.errorHandler.handleError(t)}},se.prototype.sendNotifications=function(e,t){try{(this.__notificationListeners[e]||[]).forEach(function(r){var i=r.callback;try{i(t)}catch(n){this.logger.log(v.ERROR,f(O.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",e,n.message))}}.bind(this))}catch(r){this.logger.log(v.ERROR,r.message),this.errorHandler.handleError(r)}};var Vn=function(e){return new se(e)},Mn=function(e){if(typeof e.lookup!="function")throw new Error(f(S.INVALID_USER_PROFILE_SERVICE,"USER_PROFILE_SERVICE_VALIDATOR","Missing function 'lookup'"));if(typeof e.save!="function")throw new Error(f(S.INVALID_USER_PROFILE_SERVICE,"USER_PROFILE_SERVICE_VALIDATOR","Missing function 'save'"));return!0};function xn(e,t,r,i){var n=e.experimentFeatureMap[r],a={};if(n){var o=i[n],s=(t.variables||[]).reduce(function(u,l){return u[l.id]={id:l.id,value:l.value},u},{});a=(o||[]).reduce(function(u,l){var E=s[l.id],p=t.featureEnabled&&E?E.value:l.defaultValue;return u[l.key]={id:l.id,key:l.key,type:l.type,value:p},u},{})}return a}function Fn(e,t){return(e.featureFlags||[]).reduce(function(r,i){return r[i.key]={id:i.id,key:i.key,experimentsMap:(i.experimentIds||[]).reduce(function(n,a){var o=e.experimentIdMap[a].key;return n[o]=t[o],n},{}),variablesMap:(i.variables||[]).reduce(function(n,a){return n[a.key]={id:a.id,key:a.key,type:a.type,value:a.defaultValue},n},{})},r},{})}var or=function(e){var t=function(r){var i=(r.rollouts||[]).reduce(function(a,o){return o.experiments.forEach(function(s){a[s.id]=!0}),a},{}),n=(r.featureFlags||[]).reduce(function(a,o){return a[o.id]=o.variables,a},{});return(r.experiments||[]).reduce(function(a,o){return i[o.id]||(a[o.key]={id:o.id,key:o.key,variationsMap:(o.variations||[]).reduce(function(s,u){return s[u.key]={id:u.id,key:u.key,variablesMap:xn(r,u,o.id,n)},Wt(r,o.id)&&(s[u.key].featureEnabled=u.featureEnabled),s},{})}),a},{})}(e);return{experimentsMap:t,featuresMap:Fn(e,t),revision:e.revision}},z=Ne();function ge(e,t){return e instanceof Error?e.message:t||"Unknown error"}function q(e){try{this.__initialize(e)}catch(t){z.error(t),this.__updateListeners=[],this.__configObj=null,this.__optimizelyConfigObj=null,this.__readyPromise=Promise.resolve({success:!1,reason:ge(t,"Error in initialize")})}}q.prototype.__initialize=function(e){if(this.__updateListeners=[],this.jsonSchemaValidator=e.jsonSchemaValidator,!e.datafile&&!e.sdkKey){this.__configObj=null;var t=new Error(f(S.DATAFILE_AND_SDK_KEY_MISSING,"PROJECT_CONFIG_MANAGER"));return this.__readyPromise=Promise.resolve({success:!1,reason:ge(t)}),void z.error(t)}var r,i=this.__getDatafileFromConfig(e);if(i)try{this.__configObj=N.tryCreatingProjectConfig({datafile:i,jsonSchemaValidator:this.jsonSchemaValidator,logger:z}),this.__optimizelyConfigObj=or(this.__configObj)}catch(a){z.error(a),r=a,this.__configObj=null}else this.__configObj=null;if(e.sdkKey){var n={sdkKey:e.sdkKey};this.__validateDatafileOptions(e.datafileOptions)&&K(n,e.datafileOptions),i&&this.__configObj&&(n.datafile=i),this.datafileManager=new In(n),this.datafileManager.start(),this.__readyPromise=this.datafileManager.onReady().then(this.__onDatafileManagerReadyFulfill.bind(this),this.__onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.__onDatafileManagerUpdate.bind(this))}else this.__configObj?this.__readyPromise=Promise.resolve({success:!0}):this.__readyPromise=Promise.resolve({success:!1,reason:ge(r,"Invalid datafile")})},q.prototype.__onDatafileManagerReadyFulfill=function(){var e,t=this.datafileManager.get();try{e=N.tryCreatingProjectConfig({datafile:t,jsonSchemaValidator:this.jsonSchemaValidator,logger:z})}catch(r){return z.error(r),{success:!1,reason:ge(r)}}return this.__handleNewConfigObj(e),{success:!0}},q.prototype.__onDatafileManagerReadyReject=function(e){return{success:!1,reason:ge(e,"Failed to become ready")}},q.prototype.__onDatafileManagerUpdate=function(){var e,t=this.datafileManager.get();try{e=N.tryCreatingProjectConfig({datafile:t,jsonSchemaValidator:this.jsonSchemaValidator,logger:z})}catch(r){z.error(r)}e&&this.__handleNewConfigObj(e)},q.prototype.__getDatafileFromConfig=function(e){var t=null;try{e.datafile&&(Kt(e.datafile),t=typeof e.datafile=="string"||e.datafile instanceof String?JSON.parse(e.datafile):e.datafile)}catch(r){z.error(r)}return t},q.prototype.__validateDatafileOptions=function(e){return e===void 0||typeof e=="object"&&e!==null},q.prototype.__handleNewConfigObj=function(e){var t=this.__configObj;(t?t.revision:"null")!==e.revision&&(this.__configObj=e,this.__optimizelyConfigObj=or(e),this.__updateListeners.forEach(function(r){r(e)}))},q.prototype.getConfig=function(){return this.__configObj},q.prototype.getOptimizelyConfig=function(){return this.__optimizelyConfigObj},q.prototype.onReady=function(){return this.__readyPromise},q.prototype.onUpdate=function(e){return this.__updateListeners.push(e),function(){var t=this.__updateListeners.indexOf(e);t>-1&&this.__updateListeners.splice(t,1)}.bind(this)},q.prototype.stop=function(){this.datafileManager&&this.datafileManager.stop(),this.__updateListeners=[]};var kn={ProjectConfigManager:q},ct=L.ERROR_MESSAGES,y=L.LOG_LEVEL,P=L.LOG_MESSAGES,ar=L.DECISION_SOURCES,Fe=L.FEATURE_VARIABLE_TYPES,ke=L.DECISION_NOTIFICATION_TYPES,ue=L.NOTIFICATION_TYPES;function U(e){var t=e.clientEngine;L.VALID_CLIENT_ENGINES.indexOf(t)===-1&&(e.logger.log(y.INFO,f(P.INVALID_CLIENT_ENGINE,"OPTIMIZELY",t)),t=L.NODE_CLIENT_ENGINE),this.clientEngine=t,this.clientVersion=e.clientVersion||L.NODE_CLIENT_VERSION,this.errorHandler=e.errorHandler,this.eventDispatcher=e.eventDispatcher,this.__isOptimizelyConfigValid=e.isValidInstance,this.logger=e.logger,this.projectConfigManager=new kn.ProjectConfigManager({datafile:e.datafile,datafileOptions:e.datafileOptions,jsonSchemaValidator:e.jsonSchemaValidator,sdkKey:e.sdkKey}),this.__disposeOnUpdate=this.projectConfigManager.onUpdate(function(i){this.logger.log(y.INFO,f(P.UPDATED_OPTIMIZELY_CONFIG,"OPTIMIZELY",i.revision,i.projectId)),this.notificationCenter.sendNotifications(ue.OPTIMIZELY_CONFIG_UPDATE)}.bind(this)),this.__readyPromise=this.projectConfigManager.onReady();var r=null;if(e.userProfileService)try{Mn(e.userProfileService)&&(r=e.userProfileService,this.logger.log(y.INFO,f(P.VALID_USER_PROFILE_SERVICE,"OPTIMIZELY")))}catch(i){this.logger.log(y.WARNING,i.message)}this.decisionService=Dn({userProfileService:r,logger:this.logger,UNSTABLE_conditionEvaluators:e.UNSTABLE_conditionEvaluators}),this.notificationCenter=Vn({logger:this.logger,errorHandler:this.errorHandler}),this.eventProcessor=new _n({dispatcher:this.eventDispatcher,flushInterval:e.eventFlushInterval,maxQueueSize:e.eventBatchSize,notificationCenter:this.notificationCenter}),this.eventProcessor.start(),this.__readyTimeouts={},this.__nextReadyTimeoutId=0}U.prototype.__isValidInstance=function(){return this.__isOptimizelyConfigValid&&this.projectConfigManager.getConfig()},U.prototype.activate=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(y.ERROR,f(P.INVALID_OBJECT,"OPTIMIZELY","activate")),null;if(!this.__validateInputs({experiment_key:e,user_id:t},r))return this.__notActivatingExperiment(e,t);var i=this.projectConfigManager.getConfig();if(!i)return null;try{var n=this.getVariation(e,t,r);if(n===null)return this.__notActivatingExperiment(e,t);if(!N.isRunning(i,e)){var a=f(P.SHOULD_NOT_DISPATCH_ACTIVATE,"OPTIMIZELY",e);return this.logger.log(y.DEBUG,a),n}return this._sendImpressionEvent(e,n,t,r),n}catch(s){this.logger.log(y.ERROR,s.message);var o=f(P.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(y.INFO,o),this.errorHandler.handleError(s),null}}catch(s){return this.logger.log(y.ERROR,s.message),this.errorHandler.handleError(s),null}},U.prototype._sendImpressionEvent=function(e,t,r,i){var n=this.projectConfigManager.getConfig();if(n){var a=function(o){var s=o.configObj,u=o.experimentKey,l=o.variationKey,E=o.userId,p=o.userAttributes,c=o.clientEngine,d=o.clientVersion,_=N.getVariationIdFromExperimentAndVariationKey(s,u,l),g=N.getExperimentId(s,u),h=N.getLayerId(s,g);return{type:"impression",timestamp:De(),uuid:be(),user:{id:E,attributes:ir(s,p)},context:{accountId:s.accountId,projectId:s.projectId,revision:s.revision,clientName:c,clientVersion:d,anonymizeIP:s.anonymizeIP||!1,botFiltering:s.botFiltering},layer:{id:h},experiment:{id:g,key:u},variation:{id:_,key:l}}}({experimentKey:e,variationKey:t,userId:r,userAttributes:i,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:n});this.eventProcessor.process(a),this.__emitNotificationCenterActivate(e,t,r,i)}},U.prototype.__emitNotificationCenterActivate=function(e,t,r,i){var n=this.projectConfigManager.getConfig();if(n){var a,o=N.getVariationIdFromExperimentAndVariationKey(n,e,t),s=N.getExperimentId(n,e),u={attributes:i,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:n,experimentId:s,userId:r,variationId:o,logger:this.logger},l=bn(u),E=n.experimentKeyMap[e];E&&E.variationKeyMap&&(a=E.variationKeyMap[t]),this.notificationCenter.sendNotifications(ue.ACTIVATE,{experiment:E,userId:r,attributes:i,variation:a,logEvent:l})}},U.prototype.track=function(e,t,r,i){try{if(!this.__isValidInstance())return void this.logger.log(y.ERROR,f(P.INVALID_OBJECT,"OPTIMIZELY","track"));if(!this.__validateInputs({user_id:t,event_key:e},r,i))return;var n=this.projectConfigManager.getConfig();if(!n)return;if(!N.eventWithKeyExists(n,e))return this.logger.log(y.WARNING,f(L.LOG_MESSAGES.EVENT_KEY_NOT_FOUND,"OPTIMIZELY",e)),void this.logger.log(y.WARNING,f(P.NOT_TRACKING_USER,"OPTIMIZELY",t));var a=function(s){var u=s.configObj,l=s.userId,E=s.userAttributes,p=s.clientEngine,c=s.clientVersion,d=s.eventKey,_=s.eventTags,g=N.getEventId(u,d);return{type:"conversion",timestamp:De(),uuid:be(),user:{id:l,attributes:ir(u,E)},context:{accountId:u.accountId,projectId:u.projectId,revision:u.revision,clientName:p,clientVersion:c,anonymizeIP:u.anonymizeIP||!1,botFiltering:u.botFiltering},event:{id:g,key:d},revenue:er(_,lt),value:tr(_,lt),tags:_}}({eventKey:e,eventTags:i=this.__filterEmptyValues(i),userId:t,userAttributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:n});this.logger.log(y.INFO,f(L.LOG_MESSAGES.TRACK_EVENT,"OPTIMIZELY",e,t)),this.eventProcessor.process(a),this.__emitNotificationCenterTrack(e,t,r,i)}catch(s){this.logger.log(y.ERROR,s.message),this.errorHandler.handleError(s);var o=f(P.NOT_TRACKING_USER,"OPTIMIZELY",t);this.logger.log(y.ERROR,o)}},U.prototype.__emitNotificationCenterTrack=function(e,t,r,i){try{var n=this.projectConfigManager.getConfig();if(!n)return;var a={attributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:n,eventKey:e,eventTags:i,logger:this.logger,userId:t},o=Cn(a);this.notificationCenter.sendNotifications(ue.TRACK,{eventKey:e,userId:t,attributes:r,eventTags:i,logEvent:o})}catch(s){this.logger.log(y.ERROR,s.message),this.errorHandler.handleError(s)}},U.prototype.getVariation=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(y.ERROR,f(P.INVALID_OBJECT,"OPTIMIZELY","getVariation")),null;try{if(!this.__validateInputs({experiment_key:e,user_id:t},r))return null;var i=this.projectConfigManager.getConfig();if(!i)return null;var n=i.experimentKeyMap[e];if(!n)return this.logger.log(y.DEBUG,f(ct.INVALID_EXPERIMENT_KEY,"OPTIMIZELY",e)),null;var a=this.decisionService.getVariation(i,e,t,r),o=N.isFeatureExperiment(i,n.id)?ke.FEATURE_TEST:ke.AB_TEST;return this.notificationCenter.sendNotifications(ue.DECISION,{type:o,userId:t,attributes:r||{},decisionInfo:{experimentKey:e,variationKey:a}}),a}catch(s){return this.logger.log(y.ERROR,s.message),this.errorHandler.handleError(s),null}}catch(s){return this.logger.log(y.ERROR,s.message),this.errorHandler.handleError(s),null}},U.prototype.setForcedVariation=function(e,t,r){if(!this.__validateInputs({experiment_key:e,user_id:t}))return!1;var i=this.projectConfigManager.getConfig();if(!i)return!1;try{return this.decisionService.setForcedVariation(i,e,t,r)}catch(n){return this.logger.log(y.ERROR,n.message),this.errorHandler.handleError(n),!1}},U.prototype.getForcedVariation=function(e,t){if(!this.__validateInputs({experiment_key:e,user_id:t}))return null;var r=this.projectConfigManager.getConfig();if(!r)return null;try{return this.decisionService.getForcedVariation(r,e,t)}catch(i){return this.logger.log(y.ERROR,i.message),this.errorHandler.handleError(i),null}},U.prototype.__validateInputs=function(e,t,r){try{if(e.hasOwnProperty("user_id")){var i=e.user_id;if(typeof i!="string"||i===null||i==="undefined")throw new Error(f(ct.INVALID_INPUT_FORMAT,"OPTIMIZELY","user_id"));delete e.user_id}for(var n=Object.keys(e),a=0;a<n.length;a++){var o=n[a];if(!Jt(e[o]))throw new Error(f(ct.INVALID_INPUT_FORMAT,"OPTIMIZELY",o))}return t&&Nn(t),r&&Pn(r),!0}catch(s){return this.logger.log(y.ERROR,s.message),this.errorHandler.handleError(s),!1}},U.prototype.__notActivatingExperiment=function(e,t){var r=f(P.NOT_ACTIVATING_USER,"OPTIMIZELY",t,e);return this.logger.log(y.INFO,r),null},U.prototype.__filterEmptyValues=function(e){for(var t in e)!e.hasOwnProperty(t)||e[t]!==null&&e[t]!==void 0||delete e[t];return e},U.prototype.isFeatureEnabled=function(e,t,r){try{if(!this.__isValidInstance())return this.logger.log(y.ERROR,f(P.INVALID_OBJECT,"OPTIMIZELY","isFeatureEnabled")),!1;if(!this.__validateInputs({feature_key:e,user_id:t},r))return!1;var i=this.projectConfigManager.getConfig();if(!i)return!1;var n=N.getFeatureFromKey(i,e,this.logger);if(!n)return!1;var a=!1,o=this.decisionService.getVariationForFeature(i,n,t,r),s=o.variation,u={};s&&(a=s.featureEnabled,o.decisionSource===ar.FEATURE_TEST&&(u={experimentKey:o.experiment.key,variationKey:o.variation.key},this._sendImpressionEvent(o.experiment.key,o.variation.key,t,r))),a===!0?this.logger.log(y.INFO,f(P.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",e,t)):(this.logger.log(y.INFO,f(P.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",e,t)),a=!1);var l={featureKey:e,featureEnabled:a,source:o.decisionSource,sourceInfo:u};return this.notificationCenter.sendNotifications(ue.DECISION,{type:ke.FEATURE,userId:t,attributes:r||{},decisionInfo:l}),a}catch(E){return this.logger.log(y.ERROR,E.message),this.errorHandler.handleError(E),!1}},U.prototype.getEnabledFeatures=function(e,t){try{var r=[];if(!this.__isValidInstance())return this.logger.log(y.ERROR,f(P.INVALID_OBJECT,"OPTIMIZELY","getEnabledFeatures")),r;if(!this.__validateInputs({user_id:e}))return r;var i=this.projectConfigManager.getConfig();return i&&ee(i.featureKeyMap).forEach(function(n){this.isFeatureEnabled(n.key,e,t)&&r.push(n.key)}.bind(this)),r}catch(n){return this.logger.log(y.ERROR,n.message),this.errorHandler.handleError(n),[]}},U.prototype.getFeatureVariable=function(e,t,r,i){try{return this._getFeatureVariableForType(e,t,null,r,i)}catch(n){return this.logger.log(y.ERROR,n.message),this.errorHandler.handleError(n),null}},U.prototype._getFeatureVariableForType=function(e,t,r,i,n){if(!this.__isValidInstance()){var a=r?"getFeatureVariable"+r.charAt(0).toUpperCase()+r.slice(1):"getFeatureVariable";return this.logger.log(y.ERROR,f(P.INVALID_OBJECT,"OPTIMIZELY",a)),null}if(!this.__validateInputs({feature_key:e,variable_key:t,user_id:i},n))return null;var o=this.projectConfigManager.getConfig();if(!o)return null;var s=N.getFeatureFromKey(o,e,this.logger);if(!s)return null;var u=N.getVariableForFeature(o,e,t,this.logger);if(!u)return null;if(r){if(u.type!==r)return this.logger.log(y.WARNING,f(P.VARIABLE_REQUESTED_WITH_WRONG_TYPE,"OPTIMIZELY",r,u.type)),null}else r=u.type;var l=!1,E=u.defaultValue,p=this.decisionService.getVariationForFeature(o,s,i,n);if(p.variation!==null){l=p.variation.featureEnabled;var c=N.getVariableValueForVariation(o,u,p.variation,this.logger);c!==null?l===!0?(E=c,this.logger.log(y.INFO,f(P.USER_RECEIVED_VARIABLE_VALUE,"OPTIMIZELY",t,s.key,E,i))):this.logger.log(y.INFO,f(P.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",s.key,i,t)):this.logger.log(y.INFO,f(P.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",t,p.variation.key))}else this.logger.log(y.INFO,f(P.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",i,t,s.key));var d={};p.decisionSource===ar.FEATURE_TEST&&(d={experimentKey:p.experiment.key,variationKey:p.variation.key});var _=N.getTypeCastValue(E,r,this.logger);return this.notificationCenter.sendNotifications(ue.DECISION,{type:ke.FEATURE_VARIABLE,userId:i,attributes:n||{},decisionInfo:{featureKey:e,featureEnabled:l,source:p.decisionSource,variableKey:t,variableValue:_,variableType:r,sourceInfo:d}}),_},U.prototype.getFeatureVariableBoolean=function(e,t,r,i){try{return this._getFeatureVariableForType(e,t,Fe.BOOLEAN,r,i)}catch(n){return this.logger.log(y.ERROR,n.message),this.errorHandler.handleError(n),null}},U.prototype.getFeatureVariableDouble=function(e,t,r,i){try{return this._getFeatureVariableForType(e,t,Fe.DOUBLE,r,i)}catch(n){return this.logger.log(y.ERROR,n.message),this.errorHandler.handleError(n),null}},U.prototype.getFeatureVariableInteger=function(e,t,r,i){try{return this._getFeatureVariableForType(e,t,Fe.INTEGER,r,i)}catch(n){return this.logger.log(y.ERROR,n.message),this.errorHandler.handleError(n),null}},U.prototype.getFeatureVariableString=function(e,t,r,i){try{return this._getFeatureVariableForType(e,t,Fe.STRING,r,i)}catch(n){return this.logger.log(y.ERROR,n.message),this.errorHandler.handleError(n),null}},U.prototype.getOptimizelyConfig=function(){try{return this.projectConfigManager.getConfig()?this.projectConfigManager.getOptimizelyConfig():null}catch(e){return this.logger.log(y.ERROR,e.message),this.errorHandler.handleError(e),null}},U.prototype.close=function(){try{var e=this.eventProcessor.stop();return this.__disposeOnUpdate&&(this.__disposeOnUpdate(),this.__disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.__readyTimeouts).forEach(function(t){var r=this.__readyTimeouts[t];clearTimeout(r.readyTimeout),r.onClose()}.bind(this)),this.__readyTimeouts={},e.then(function(){return{success:!0}},function(t){return{success:!1,reason:String(t)}})}catch(t){return this.logger.log(y.ERROR,t.message),this.errorHandler.handleError(t),Promise.resolve({success:!1,reason:String(t)})}},U.prototype.onReady=function(e){var t,r;typeof e=="object"&&e!==null&&(t=e.timeout),J(t)||(t=3e4);var i=new Promise(function(s){r=s}),n=this.__nextReadyTimeoutId;this.__nextReadyTimeoutId++;var a=function(){delete this.__readyTimeouts[n],r({success:!1,reason:f("onReady timeout expired after %s ms",t)})}.bind(this),o=setTimeout(a,t);return this.__readyTimeouts[n]={readyTimeout:o,onClose:function(){r({success:!1,reason:"Instance closed"})}},this.__readyPromise.then(function(){clearTimeout(o),delete this.__readyTimeouts[n],r({success:!0})}.bind(this)),Promise.race([this.__readyPromise,i])};var wn=function(e){return at(e)&&e>=1},Bn=function(e){return at(e)&&e>0},le=Ne();tt(qt.createLogger()),Ae(Mt.INFO);var ft=!1,Gn=function(e){try{(e=e||{}).errorHandler&&gn(e.errorHandler),e.logger&&(tt(e.logger),Ae(Mt.NOTSET)),e.logLevel!==void 0&&Ae(e.logLevel);try{Rn(e),e.isValidInstance=!0}catch(n){le.error(n),e.isValidInstance=!1}var t;e.eventDispatcher==null?(t=new hn({eventDispatcher:jt}),ft||(t.sendPendingEvents(),ft=!0)):t=e.eventDispatcher,e=K({clientEngine:L.JAVASCRIPT_CLIENT_ENGINE,eventBatchSize:10,eventFlushInterval:1e3},e,{eventDispatcher:t,logger:le,errorHandler:pn()}),wn(e.eventBatchSize)||(le.warn("Invalid eventBatchSize %s, defaulting to %s",e.eventBatchSize,10),e.eventBatchSize=10),Bn(e.eventFlushInterval)||(le.warn("Invalid eventFlushInterval %s, defaulting to %s",e.eventFlushInterval,1e3),e.eventFlushInterval=1e3);var r=new U(e);try{if(typeof window.addEventListener=="function"){var i="onpagehide"in window?"pagehide":"unload";window.addEventListener(i,function(){r.close()},!1)}}catch(n){le.error(L.LOG_MESSAGES.UNABLE_TO_ATTACH_UNLOAD,"INDEX_BROWSER",n.message)}return r}catch(n){return le.error(n),null}},Kn=function(){ft=!1},dt={logging:qt,errorHandler:Tn,eventDispatcher:jt,enums:L,setLogger:tt,setLogLevel:Ae,createInstance:Gn,__internalResetRetryState:Kn},jn=Object.defineProperty,we=(e,t)=>jn(e,"name",{value:t,configurable:!0});const Hn={handleError(e){cr(e)}};function sr(){var e;ur();const t=(e=document.head.querySelector("meta[name=optimizely-datafile]"))==null?void 0:e.content;return dt.createInstance({datafile:t,errorHandler:Hn})}we(sr,"createInstance");function ur(){const e=lr("optimizely.logLevel");e?dt.setLogLevel(e):dt.setLogger(null)}we(ur,"configureLogger");function lr(e){var t;try{return(t=window.localStorage)==null?void 0:t.getItem(e)}catch(r){return null}}we(lr,"localStorage");async function cr(e){var t,r;const i=(r=(t=document.head)==null?void 0:t.querySelector('meta[name="browser-optimizely-client-errors-url"]'))==null?void 0:r.content;if(!i)return;const n={message:e.message,stack:e.stack,stacktrace:Ze(e),sanitizedUrl:Je()||window.location.href,user:Qe()||void 0};try{await fetch(i,{method:"post",body:JSON.stringify(n)})}catch(a){}}we(cr,"reportError");var qn=Object.defineProperty,Be=(e,t)=>qn(e,"name",{value:t,configurable:!0});function Ge(e){const t=[];for(const r of fr()){const[i,n]=r.trim().split("=");e===i&&typeof n!="undefined"&&t.push({key:i,value:n})}return t}Be(Ge,"getCookies");function fr(){try{return document.cookie.split(";")}catch(e){return[]}}Be(fr,"readCookies");function Yn(e,t,r=null,i=!1,n="lax"){let a=document.domain;if(a==null)throw new Error("Unable to get document domain");a.endsWith(".github.com")&&(a="github.com");const o=location.protocol==="https:"?"; secure":"",s=r?`; expires=${r}`:"";i===!1&&(a=`.${a}`);try{document.cookie=`${e}=${t}; path=/; domain=${a}${s}${o}; samesite=${n}`}catch(u){}}Be(Yn,"setCookie");function Wn(e,t=!1){let r=document.domain;if(r==null)throw new Error("Unable to get document domain");r.endsWith(".github.com")&&(r="github.com");const i=new Date().getTime(),n=new Date(i-1).toUTCString(),a=location.protocol==="https:"?"; secure":"",o=`; expires=${n}`;t===!1&&(r=`.${r}`);try{document.cookie=`${e}=''; path=/; domain=${r}${o}${a}`}catch(s){}}Be(Wn,"deleteCookie");function B(){if(!(this instanceof B))return new B;this.size=0,this.uid=0,this.selectors=[],this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var pe=window.document.documentElement,zn=pe.matches||pe.webkitMatchesSelector||pe.mozMatchesSelector||pe.oMatchesSelector||pe.msMatchesSelector;B.prototype.matchesSelector=function(e,t){return zn.call(e,t)},B.prototype.querySelectorAll=function(e,t){return t.querySelectorAll(e)},B.prototype.indexes=[];var Xn=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;B.prototype.indexes.push({name:"ID",selector:function(t){var r;if(r=t.match(Xn))return r[0].slice(1)},element:function(t){if(t.id)return[t.id]}});var $n=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;B.prototype.indexes.push({name:"CLASS",selector:function(t){var r;if(r=t.match($n))return r[0].slice(1)},element:function(t){var r=t.className;if(r){if(typeof r=="string")return r.split(/\s/);if(typeof r=="object"&&"baseVal"in r)return r.baseVal.split(/\s/)}}});var Jn=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;B.prototype.indexes.push({name:"TAG",selector:function(t){var r;if(r=t.match(Jn))return r[0].toUpperCase()},element:function(t){return[t.nodeName.toUpperCase()]}}),B.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}};var Et;typeof window.Map=="function"?Et=window.Map:Et=function(){function e(){this.map={}}return e.prototype.get=function(t){return this.map[t+" "]},e.prototype.set=function(t,r){this.map[t+" "]=r},e}();var dr=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function Er(e,t){e=e.slice(0).concat(e.default);var r=e.length,i,n,a,o,s=t,u,l,E=[];do if(dr.exec(""),(a=dr.exec(s))&&(s=a[3],a[2]||!s)){for(i=0;i<r;i++)if(l=e[i],u=l.selector(a[1])){for(n=E.length,o=!1;n--;)if(E[n].index===l&&E[n].key===u){o=!0;break}o||E.push({index:l,key:u});break}}while(a);return E}function Zn(e,t){var r,i,n;for(r=0,i=e.length;r<i;r++)if(n=e[r],t.isPrototypeOf(n))return n}B.prototype.logDefaultIndexUsed=function(){},B.prototype.add=function(e,t){var r,i,n,a,o,s,u,l,E=this.activeIndexes,p=this.selectors;if(typeof e=="string"){for(r={id:this.uid++,selector:e,data:t},u=Er(this.indexes,e),i=0;i<u.length;i++)l=u[i],a=l.key,n=l.index,o=Zn(E,n),o||(o=Object.create(n),o.map=new Et,E.push(o)),n===this.indexes.default&&this.logDefaultIndexUsed(r),s=o.map.get(a),s||(s=[],o.map.set(a,s)),s.push(r);this.size++,p.push(e)}},B.prototype.remove=function(e,t){if(typeof e=="string"){var r,i,n,a,o,s,u,l,E=this.activeIndexes,p={},c=arguments.length===1;for(r=Er(this.indexes,e),n=0;n<r.length;n++)for(i=r[n],a=E.length;a--;)if(s=E[a],i.index.isPrototypeOf(s)){if(u=s.map.get(i.key),u)for(o=u.length;o--;)l=u[o],l.selector===e&&(c||l.data===t)&&(u.splice(o,1),p[l.id]=!0);break}this.size-=Object.keys(p).length}};function gr(e,t){return e.id-t.id}B.prototype.queryAll=function(e){if(!this.selectors.length)return[];var t={},r=[],i=this.querySelectorAll(this.selectors.join(", "),e),n,a,o,s,u,l,E,p;for(n=0,o=i.length;n<o;n++)for(u=i[n],l=this.matches(u),a=0,s=l.length;a<s;a++)p=l[a],t[p.id]?E=t[p.id]:(E={id:p.id,selector:p.selector,data:p.data,elements:[]},t[p.id]=E,r.push(E)),E.elements.push(u);return r.sort(gr)},B.prototype.matches=function(e){if(!e)return[];var t,r,i,n,a,o,s,u,l,E,p,c=this.activeIndexes,d={},_=[];for(t=0,n=c.length;t<n;t++)if(s=c[t],u=s.element(e),u){for(r=0,a=u.length;r<a;r++)if(l=s.map.get(u[r]))for(i=0,o=l.length;i<o;i++)E=l[i],p=E.id,!d[p]&&this.matchesSelector(e,E.selector)&&(d[p]=!0,_.push(E))}return _.sort(gr)};var Ke=null,gt=null,pt=[];function pr(e,t){var r=[];function i(){var a=r;r=[],t(a)}function n(){for(var a=arguments.length,o=Array(a),s=0;s<a;s++)o[s]=arguments[s];r.push(o),r.length===1&&_t(e,i)}return n}function _t(e,t){gt||(gt=new MutationObserver(Qn)),Ke||(Ke=e.createElement("div"),gt.observe(Ke,{attributes:!0})),pt.push(t),Ke.setAttribute("data-twiddle",""+Date.now())}function Qn(){var e=pt;pt=[];for(var t=0;t<e.length;t++)try{e[t]()}catch(r){setTimeout(function(){throw r},0)}}var _r=new WeakMap,_e=new WeakMap,je=new WeakMap,re=new WeakMap;function He(e,t){for(var r=0;r<t.length;r++){var i=t[r],n=i[0],a=i[1],o=i[2];n===qe?(ei(o,a),ti(o,a)):n===Ir?hr(o,a):n===Ye&&ri(e.observers,a)}}function ei(e,t){if(t instanceof e.elementConstructor){var r=_r.get(t);if(r||(r=[],_r.set(t,r)),r.indexOf(e.id)===-1){var i=void 0;if(e.initialize&&(i=e.initialize.call(void 0,t)),i){var n=_e.get(t);n||(n={},_e.set(t,n)),n[""+e.id]=i}r.push(e.id)}}}function ti(e,t){if(t instanceof e.elementConstructor){var r=re.get(t);if(r||(r=[],re.set(t,r)),r.indexOf(e.id)===-1){e.elements.push(t);var i=_e.get(t),n=i?i[""+e.id]:null;if(n&&n.add&&n.add.call(void 0,t),e.subscribe){var a=e.subscribe.call(void 0,t);if(a){var o=je.get(t);o||(o={},je.set(t,o)),o[""+e.id]=a}}e.add&&e.add.call(void 0,t),r.push(e.id)}}}function hr(e,t){if(t instanceof e.elementConstructor){var r=re.get(t);if(!!r){var i=e.elements.indexOf(t);if(i!==-1&&e.elements.splice(i,1),i=r.indexOf(e.id),i!==-1){var n=_e.get(t),a=n?n[""+e.id]:null;if(a&&a.remove&&a.remove.call(void 0,t),e.subscribe){var o=je.get(t),s=o?o[""+e.id]:null;s&&s.unsubscribe&&s.unsubscribe()}e.remove&&e.remove.call(void 0,t),r.splice(i,1)}r.length===0&&re.delete(t)}}}function ri(e,t){var r=re.get(t);if(!!r){for(var i=r.slice(0),n=0;n<i.length;n++){var a=e[i[n]];if(!!a){var o=a.elements.indexOf(t);o!==-1&&a.elements.splice(o,1);var s=_e.get(t),u=s?s[""+a.id]:null;u&&u.remove&&u.remove.call(void 0,t);var l=je.get(t),E=l?l[""+a.id]:null;E&&E.unsubscribe&&E.unsubscribe(),a.remove&&a.remove.call(void 0,t)}}re.delete(t)}}var ht=null;function ni(e){if(ht===null){var t=e.createElement("div"),r=e.createElement("div"),i=e.createElement("div");t.appendChild(r),r.appendChild(i),t.innerHTML="",ht=i.parentNode!==r}return ht}function vr(e){return"matches"in e||"webkitMatchesSelector"in e||"mozMatchesSelector"in e||"oMatchesSelector"in e||"msMatchesSelector"in e}var qe=1,Ir=2,Ye=3;function ii(e,t,r){for(var i=0;i<r.length;i++){var n=r[i];n.type==="childList"?(mr(e,t,n.addedNodes),oi(e,t,n.removedNodes)):n.type==="attributes"&&We(e,t,n.target)}ni(e.ownerDocument)&&ui(e,t)}function mr(e,t,r){for(var i=0;i<r.length;i++){var n=r[i];if(vr(n))for(var a=e.selectorSet.matches(n),o=0;o<a.length;o++){var s=a[o].data;t.push([qe,n,s])}if("querySelectorAll"in n)for(var u=e.selectorSet.queryAll(n),l=0;l<u.length;l++)for(var E=u[l],p=E.data,c=E.elements,d=0;d<c.length;d++)t.push([qe,c[d],p])}}function oi(e,t,r){for(var i=0;i<r.length;i++){var n=r[i];if("querySelectorAll"in n){t.push([Ye,n]);for(var a=n.querySelectorAll("*"),o=0;o<a.length;o++)t.push([Ye,a[o]])}}}function We(e,t,r){if(vr(r))for(var i=e.selectorSet.matches(r),n=0;n<i.length;n++){var a=i[n].data;t.push([qe,r,a])}if("querySelectorAll"in r){var o=re.get(r);if(o)for(var s=0;s<o.length;s++){var u=e.observers[o[s]];u&&(e.selectorSet.matchesSelector(r,u.selector)||t.push([Ir,r,u]))}}}function ai(e,t,r){if("querySelectorAll"in r){We(e,t,r);for(var i=r.querySelectorAll("*"),n=0;n<i.length;n++)We(e,t,i[n])}}function si(e,t,r){for(var i=0;i<r.length;i++)for(var n=r[i],a=n.form?n.form.elements:e.rootNode.querySelectorAll("input"),o=0;o<a.length;o++)We(e,t,a[o])}function ui(e,t){for(var r=0;r<e.observers.length;r++){var i=e.observers[r];if(i)for(var n=i.elements,a=0;a<n.length;a++){var o=n[a];o.parentNode||t.push([Ye,o])}}}function li(e,t){var r=e.readyState;r==="interactive"||r==="complete"?_t(e,t):e.addEventListener("DOMContentLoaded",_t(e,t))}var ci=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fi=0;function he(e){this.rootNode=e.nodeType===9?e.documentElement:e,this.ownerDocument=e.nodeType===9?e:e.ownerDocument,this.observers=[],this.selectorSet=new B,this.mutationObserver=new MutationObserver(gi.bind(this,this)),this._scheduleAddRootNodes=pr(this.ownerDocument,Ei.bind(this,this)),this._handleThrottledChangedTargets=pr(this.ownerDocument,_i.bind(this,this)),this.rootNode.addEventListener("change",pi.bind(this,this),!1),li(this.ownerDocument,di.bind(this,this))}he.prototype.disconnect=function(){this.mutationObserver.disconnect()},he.prototype.observe=function(e,t){var r=void 0;typeof t=="function"?r={selector:e,initialize:t}:(typeof t=="undefined"?"undefined":ci(t))==="object"?(r=t,r.selector=e):r=e;var i=this,n={id:fi++,selector:r.selector,initialize:r.initialize,add:r.add,remove:r.remove,subscribe:r.subscribe,elements:[],elementConstructor:r.hasOwnProperty("constructor")?r.constructor:this.ownerDocument.defaultView.Element,abort:function(){i._abortObserving(n)}};return this.selectorSet.add(n.selector,n),this.observers[n.id]=n,this._scheduleAddRootNodes(),n},he.prototype._abortObserving=function(e){for(var t=e.elements,r=0;r<t.length;r++)hr(e,t[r]);this.selectorSet.remove(e.selector,e),delete this.observers[e.id]},he.prototype.triggerObservers=function(e){var t=[];ai(this,t,e),He(this,t)};function di(e){e.mutationObserver.observe(e.rootNode,{childList:!0,attributes:!0,subtree:!0}),e._scheduleAddRootNodes()}function Ei(e){var t=[];mr(e,t,[e.rootNode]),He(e,t)}function gi(e,t){var r=[];ii(e,r,t),He(e,r)}function pi(e,t){e._handleThrottledChangedTargets(t.target)}function _i(e,t){var r=[];si(e,r,t),He(e,r)}var vt=void 0;function hi(){return vt||(vt=new he(window.document)),vt}function vi(){var e;return(e=hi()).observe.apply(e,arguments)}var yr={},Rr={},It=new WeakMap,Tr=new WeakMap,mt=new WeakMap,Or=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function Nr(e,t,r){var i=e[t];return e[t]=function(){return r.apply(e,arguments),i.apply(e,arguments)},e}function Ii(e,t,r){var i=[],n=t;do{if(n.nodeType!==1)break;var a=e.matches(n);if(a.length){var o={node:n,observers:a};r?i.unshift(o):i.push(o)}}while(n=n.parentElement);return i}function mi(){It.set(this,!0)}function yi(){It.set(this,!0),Tr.set(this,!0)}function Ri(){return mt.get(this)||null}function Ar(e,t){!Or||Object.defineProperty(e,"currentTarget",{configurable:!0,enumerable:!0,get:t||Or.get})}function Ti(e){try{return e.eventPhase,!0}catch(t){return!1}}function Oi(e){if(!!Ti(e)){var t=e.eventPhase===1?Rr:yr,r=t[e.type];if(!!r){var i=Ii(r,e.target,e.eventPhase===1);if(!!i.length){Nr(e,"stopPropagation",mi),Nr(e,"stopImmediatePropagation",yi),Ar(e,Ri);for(var n=0,a=i.length;n<a&&!It.get(e);n++){var o=i[n];mt.set(e,o.node);for(var s=0,u=o.observers.length;s<u&&!Tr.get(e);s++)o.observers[s].data.call(o.node,e)}mt.delete(e),Ar(e)}}}}function Sr(e,t,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=!!i.capture,a=n?Rr:yr,o=a[e];o||(o=new B,a[e]=o,document.addEventListener(e,Oi,n)),o.add(t,r)}var Ni=Object.defineProperty,ve=(e,t)=>Ni(e,"name",{value:t,configurable:!0}),Lr,Ur;let x;(async function(){x=sr(),await x.onReady()})();function Dr(e){return e.toLowerCase().replace(/-(.)/g,function(t,r){return r.toUpperCase()})}ve(Dr,"camelCase");function ze(e){const t={};for(const{name:r,value:i}of e.attributes)if(r.startsWith("data-optimizely-meta-")){const n=r.replace("data-optimizely-meta-","");i&&i.trim().length&&(t[Dr(n)]=i)}return t}ve(ze,"getUserAttributes"),Sr("click","[data-optimizely-event]",function(e){if(!x)return;const t=e.currentTarget,r=t.getAttribute("data-optimizely-event")||"",[i,n]=r.trim().split(/\s*,\s*/),a=ze(t);i&&n?x.track(i,n,a):i&&x.track(i,Z(),a)}),vi("[data-optimizely-experiment]",e=>{if(!x)return;const t=e.getAttribute("data-optimizely-experiment");if(!t||e.hidden)return;const r=ze(e),i=x.activate(t,Z(),r);if(!i)return;const n=e.querySelectorAll("[data-optimizely-variation]");for(const a of n){const o=a.getAttribute("data-optimizely-variation");a.hidden=o!==i}});const Ai=((Ur=(Lr=document.querySelector('meta[name="enabled-homepage-translation-languages"]'))==null?void 0:Lr.getAttribute("content"))==null?void 0:Ur.split(","))||[],br=Ge("_locale_experiment").length>0&&Ge("_locale_experiment")[0].value==="ko"&&Ai.includes("ko");br&&window.location.pathname==="/"&&Cr(),br&&window.location.pathname==="/join"&&Pr();async function Cr(){var e,t;const r="ko_homepage_translation",i=Z(),n=(t=(e=Ge("_locale")[0])==null?void 0:e.value)==null?void 0:t.slice(0,2);x.setForcedVariation(r,i,n),x.activate(r,i);const a=document.querySelectorAll("[data-optimizely-variation]");for(const o of a)o.hidden=n!==o.getAttribute("data-optimizely-variation");for(const o of document.querySelectorAll('form[action^="/join"]'))o.addEventListener("submit",()=>{x.track("submit.homepage_signup",i)});for(const o of document.querySelectorAll('a[href^="/join"]'))o.addEventListener("click",()=>{x.track("click.homepage_signup",i)})}ve(Cr,"runKoreanHomepageExperiment");async function Pr(){var e;(e=document.getElementById("signup-form"))==null||e.addEventListener("submit",()=>{const t="ko_homepage_translation",r=Z();x.activate(t,r),x.track("submit.create_account",r)})}ve(Pr,"trackSignupsFromKoreanHomepage");const ce=document.querySelector('meta[name^="user-currency"]');ce&&window.location.pathname==="/pricing"&&Vr();async function Vr(){var e,t,r;const i=((t=(e=document.querySelector('meta[name^="supported-currencies"]'))==null?void 0:e.getAttribute("content"))==null?void 0:t.split(","))||[],n="local_currency_pricing",a="view.pricing_page",o="usd",s="localized_currency",u=Z(),l=(r=ce==null?void 0:ce.getAttribute("content"))==null?void 0:r.toUpperCase(),E=new URLSearchParams(window.location.search);if(l==="USD"||!l||!i.includes(l))return;E.has("currency")&&x.setForcedVariation(n,u,s);const c=x.activate(n,u)===o?"USD":l;x.track(a,u,{requestedCurrency:l});for(const d of document.querySelectorAll("[data-currency]"))d.hidden=d.getAttribute("data-currency")!==c}return ve(Vr,"runCurrencyExperiment"),Sr("click","#signup_button",function(){var e,t;if(!x||!ce)return;const r=new URLSearchParams(document.location.href);if(!(r.get("pricing_exp")&&((e=r.get("ref_page"))==null?void 0:e.startsWith("/pricing"))))return;const n="submit.create_account",a=(t=ce==null?void 0:ce.getAttribute("content"))==null?void 0:t.toUpperCase();x.track(n,Z(),{requestedCurrency:a})}),Xe.getUserAttributes=ze,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe})({});
//# sourceMappingURL=optimizely-358c4ac8.js.map
